<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic 8-Ball</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            font-family: 'Arial', sans-serif;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px 0;
        }

        h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .instruction {
            color: rgba(255,255,255,0.9);
            font-size: 1.2em;
            margin-bottom: 40px;
            text-align: center;
        }

        .ball-container {
            perspective: 1000px;
            cursor: pointer;
        }

        .ball {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle at 100px 100px, #2d2d2d, #000000);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset -20px -20px 50px rgba(0,0,0,0.8),
                inset 20px 20px 50px rgba(255,255,255,0.1),
                0 20px 50px rgba(0,0,0,0.5);
            transition: transform 0.1s ease;
            position: relative;
        }

        .ball.shaking {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg) translateX(0); }
            10% { transform: rotate(-10deg) translateX(-10px); }
            20% { transform: rotate(10deg) translateX(10px); }
            30% { transform: rotate(-10deg) translateX(-10px); }
            40% { transform: rotate(10deg) translateX(10px); }
            50% { transform: rotate(-10deg) translateX(-10px); }
            60% { transform: rotate(10deg) translateX(10px); }
            70% { transform: rotate(-10deg) translateX(-10px); }
            80% { transform: rotate(10deg) translateX(10px); }
            90% { transform: rotate(-5deg) translateX(-5px); }
        }

        .window {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset 0 0 20px rgba(0,0,0,0.5),
                0 0 20px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .answer {
            color: white;
            font-size: 0.9em;
            text-align: center;
            padding: 15px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .answer.visible {
            opacity: 1;
        }

        .quote-panel {
            margin-top: 40px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #e9d5ff 0%, #ddd6fe 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            max-width: 600px;
            width: fit-content;
            max-width: 90%;
            display: none;
            border: 2px solid #c4b5fd;
        }

        .quote-panel.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .quote-text {
            font-size: 1.1em;
            font-style: italic;
            color: #4c1d95;
            line-height: 1.6;
            text-align: center;
        }

        .quote-label {
            font-size: 0.9em;
            color: #6d28d9;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .number-8 {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4em;
            font-weight: bold;
            color: white;
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.5),
                0 0 10px rgba(255,255,255,0.3);
        }
        .screenshot-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 500px;
        }
        
        .screenshot-card h2 {
            color: white;
            margin: 0 0 20px 0;
            text-align: center;
        }
        
        .screenshot-card .question-display {
            color: white;
            font-size: 1.2em;
            font-style: italic;
            margin-bottom: 30px;
            text-align: center;
        }
        .preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .preview-modal.visible {
            display: flex;
        }
        
        .preview-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
        }
        
        .preview-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .preview-buttons button {
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        
        .preview-buttons button:hover {
            transform: scale(1.05);
        }
        
    </style>
</head>
<body>
    <h1>ðŸ”® Magic 8-Ball ðŸ”®</h1>
    <p class="instruction">Ask a yes/no question!</p>
    
    <div style="margin-bottom: 30px; text-align: center;">
        <input type="text" id="question" placeholder="Enter your question..." style="
            width: 400px;
            max-width: 90vw;
            padding: 15px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 15px;
        ">
        <br>
        <button onclick="askQuestion()" style="
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.1s ease;
        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            Ask the 8-Ball
        </button>
        <button id="screenshotBtn" onclick="takeScreenshot()" style="
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.1s ease;
            margin-left: 10px;
            display: none;
        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            ðŸ“¸ Take Screenshot
        </button>
    </div>
    
    <div id="displayQuestion" style="
        color: white;
        font-size: 1.3em;
        font-style: italic;
        margin-bottom: 30px;
        text-align: center;
        min-height: 30px;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    "></div>
    
    <div class="ball-container" onclick="shakeBall()">
        <div class="ball" id="ball">
            <div class="number-8">8</div>
            <div class="window">
                <div class="answer" id="answer"></div>
            </div>
        </div>
    </div>

    <div class="quote-panel" id="quotePanel">
        <div class="quote-label">From The Book of Carp:</div>
        <div class="quote-text" id="quoteText"></div>
    </div>

    <div id="previewModal" class="preview-modal" onclick="closePreview(event)">
        <div class="preview-content" onclick="event.stopPropagation()">
            <div id="previewImage"></div>
            <div class="preview-buttons">
                <button onclick="copyToClipboard()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
                    ðŸ“‹ Copy to Clipboard
                </button>
                <button onclick="downloadScreenshot()" style="background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: white;">
                    ðŸ’¾ Download PNG
                </button>
                <button onclick="closePreview()" style="background: linear-gradient(135deg, #f87171 0%, #dc2626 100%); color: white;">
                    âœ– Close
                </button>
            </div>
        </div>
    </div>

    <script>
        let carpQuotes = [];

        // Fetch quotes from thebookofcarp.txt
        async function loadQuotes() {
            try {
                const response = await fetch('thebookofcarp.txt');
                const text = await response.text();
                carpQuotes = text.split('\n').filter(line => line.trim() !== '');
            } catch (error) {
                console.error('Error loading quotes:', error);
                carpQuotes = ['The Book of Carp could not be loaded.'];
            }
        }

        // Load quotes when page loads
        loadQuotes();

        const answers = [
            "It is certain",
            "It is decidedly so",
            "Oh, that's definitely a yes",
            "Definitely, but only if you say please",
            "Yes. Yes indeed. Quite.",
            "Yeah I guess",
            "FUCK YEAH",
            "Of course",
            "Yuuuup",
            "Totally",
            "I suppose",
            "Heh, yeah",
            "Abso-fuckin-lutely",
            "Yupperino",
            "It's obviously yes",
            "That's gonna be a big thumbs up from me bud",
            "Sure why not",
            "Yaaaaaasssss queen",
            "SeemsGood",
            "Haha, oh yeah",
            "Without a doubt",
            "Yes definitely",
            "You may rely on it",
            "Fo sho, yo",
            "10-4",
            "Oooooh yeah",
            "As I see it, yes",
            "Positively and absolutely",
            "Most likely",
            "Outlook good",
            "I wasn't really listening, but yes",
            "Yes",
            "Signs point to yes",
            "Affirmative, captain",
            "You know it",
            "Hell yeah brother",
            "Damn straight",
            "It's a vibe and that vibe is yes",
            "Big yes",
            "Absolutely, no cap",
            "You son of a bitch, I'm in",
            "Roger that",
            "My gut says yes and my gut is never wrong",
            "Scientific fact: yes",
            "Is the pope Catholic?",
            "That's a certified banger of a yes",
            "This one sparks joy (yes)",
            "I'm gonna go with a hard yes on this one chief",
            "The prophecy foretold it (yes)",
            "Reply hazy try again",
            "The real answer is the friends we made along the way",
            "Ask again later",
            "Wouldn't you like to know",
            "What is that supposed to mean",
            "Sandstorm by Darude",
            "S",
            "Ban Juicy",
            "Ask Ellie",
            "Depends on who's asking",
            "TBD",
            "Better not tell you now",
            "Eh",
            "CORN",
            "That's a good question",
            "OpieOP",
            "Cannot predict now",
            "Lmao",
            "8==D",
            "No...I mean yes...Well...Ask again later.",
            "Ask again when the moon is full",
            "Does a bear shit in the woods?",
            "Concentrate and ask again",
            "Unclear, please reboot universe",
            "The spirits are busy, call back later",
            "Magic 8-ball is currently updating",
            "I plead the fifth",
            "Choose your own adventure",
            "Â¯\\_(ãƒ„)_/Â¯",
            "Insufficient data for meaningful answer",
            "That's above my pay grade",
            "The jury's still out",
            "Schrodinger says both yes and no",
            "Vibes are unclear",
            "Hold on let me ask my lawyer",
            "Processing... Please hold",
            "I mean... maybe?",
            "That's a Wednesday problem",
            "Probably? Possibly? Perhaps?",
            "I'm not qualified to answer that",
            "The answer lies within yourself",
            "Flip a coin honestly",
            "That's classified information",
            "Big if true",
            "Gonna need more context here",
            "The prophecy is unclear",
            "Try asking in iambic pentameter",
            "I have no strong feelings one way or the other",
            "Define \"answer\"",
            "Sources are conflicting",
            "My crystal ball is in the shop",
            "The algorithm says: ????",
            "Check back after Mercury retrograde",
            "Don't count on it",
            "My reply is no",
            "No, $username, mayonnaise is not an instrument",
            "My sources say no",
            "No frickin way",
            "NOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",
            "Outlook not so good",
            "Very doubtful",
            "Not a snowball's chance in hell",
            "Not gonna happen buddy",
            "Negative",
            "Absolutely not, why would you even consider that",
            "VoteNay",
            "What? BabyRage No.",
            "Case is not compelling",
            "wtf no lol",
            "Of course not, are you insane?",
            "Hahaha. No.",
            "Mayhaps",
            "That's a thumbs down",
            "Well since you asked so nicely, no",
            "Fat chance",
            "Your guess is as good as mine",
            "NAYETH",
            "Never in a million, billion, trillion years",
            "Nah",
            "Naaaah man",
            "Signs point to no",
            "The odds are not in your favor",
            "No, and don't ask me again",
            "Absolutely fucking not",
            "Hard pass",
            "Nope nope nope nope nope",
            "Not on my watch",
            "That's gonna be a no from me dawg",
            "Error 404: Yes not found",
            "The council has decided: no",
            "I'm afraid I can't let you do that",
            "Counterpoint: no",
            "Have you considered: no?",
            "This ain't it",
            "Nah fam",
            "Not even if you paid me",
            "Zero chance, zilch, nada",
            "What part of no don't you understand",
            "Not in this timeline",
            "Negatory",
            "Absolutely not in any conceivable universe",
            "Shut it down",
            "Over my dead body",
            "Yeah that's a no for me",
            "The vibes are off (no)"
        ];

        function shakeBall() {
            const ball = document.getElementById('ball');
            const answerEl = document.getElementById('answer');
            const quotePanel = document.getElementById('quotePanel');
            const quoteText = document.getElementById('quoteText');
            const displayQuestion = document.getElementById('displayQuestion');
            
            // Only proceed if there's a question displayed
            if (!displayQuestion.textContent.trim()) {
                return; // Don't shake if no question was asked
            }
            
            // Hide current answer and quote
            answerEl.classList.remove('visible');
            quotePanel.classList.remove('visible');
            
            // Add shaking animation
            ball.classList.add('shaking');
            
            // Remove animation class after it completes
            setTimeout(() => {
                ball.classList.remove('shaking');
                
                // Show random answer
                const randomAnswer = answers[Math.floor(Math.random() * answers.length)];
                answerEl.textContent = randomAnswer;
                answerEl.classList.add('visible');

                // Show random quote from Book of Carp
                if (carpQuotes.length > 0) {
                    let randomQuote = carpQuotes[Math.floor(Math.random() * carpQuotes.length)];
                    
                    // Extract text between first and last quotation marks
                    const firstQuote = randomQuote.indexOf('"');
                    const lastQuote = randomQuote.lastIndexOf('"');
                    
                    if (firstQuote !== -1 && lastQuote !== -1 && firstQuote !== lastQuote) {
                        randomQuote = randomQuote.substring(firstQuote + 1, lastQuote);
                    }
                    
                    quoteText.textContent = randomQuote;
                    quotePanel.classList.add('visible');
                    document.getElementById('screenshotBtn').style.display = 'inline-block';
                }
            }, 500);
        }

        function askQuestion() {
            const questionInput = document.getElementById('question');
            const displayQuestion = document.getElementById('displayQuestion');
            
            // Only shake if there's a question
            if (questionInput.value.trim()) {
                // Display the question
                displayQuestion.textContent = '"' + questionInput.value + '"';
                
                shakeBall();
                questionInput.value = ''; // Clear the question box
            }
        }

        let currentCanvas = null;

        async function takeScreenshot() {
            const displayQuestion = document.getElementById('displayQuestion');
            const answerEl = document.getElementById('answer');
            const quoteText = document.getElementById('quoteText');
            
            if (!displayQuestion.textContent.trim()) {
                alert('Please ask a question first!');
                return;
            }
            
            // Get the scale factor (200px screenshot / 300px original = 0.667)
            const scale = 0.667;
            
            // Create a temporary container for the screenshot
            const card = document.createElement('div');
            card.className = 'screenshot-card';
            card.style.position = 'fixed';
            card.style.left = '-9999px';
            card.innerHTML = `
                <h2 style="color: white; margin: 0 0 20px 0; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">ðŸ”® Magic 8-Ball ðŸ”®</h2>
                <div style="color: white; font-size: 1.2em; font-style: italic; margin-bottom: 30px; text-align: center;">${displayQuestion.textContent}</div>
                <div style="display: flex; justify-content: center; margin-bottom: 30px;">
                    <div style="
                        width: ${300 * scale}px;
                        height: ${300 * scale}px;
                        border-radius: 50%;
                        background: radial-gradient(circle at ${100 * scale}px ${100 * scale}px, #2d2d2d, #000000);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 
                            inset ${-20 * scale}px ${-20 * scale}px ${50 * scale}px rgba(0,0,0,0.8),
                            inset ${20 * scale}px ${20 * scale}px ${50 * scale}px rgba(255,255,255,0.1),
                            0 ${20 * scale}px ${50 * scale}px rgba(0,0,0,0.5);
                        position: relative;
                    ">
                        <div style="
                            position: absolute;
                            top: ${30 * scale}px;
                            left: 50%;
                            transform: translateX(-50%);
                            font-size: ${4 * scale}em;
                            font-weight: bold;
                            color: white;
                            text-shadow: 
                                2px 2px 4px rgba(0,0,0,0.5),
                                0 0 10px rgba(255,255,255,0.3);
                        ">8</div>
                        <div style="
                            width: ${120 * scale}px;
                            height: ${120 * scale}px;
                            border-radius: 50%;
                            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 
                                inset 0 0 ${20 * scale}px rgba(0,0,0,0.5),
                                0 0 ${20 * scale}px rgba(59, 130, 246, 0.3);
                            overflow: hidden;
                        ">
                            <div style="
                                color: white;
                                font-size: ${0.9 * scale}em;
                                text-align: center;
                                padding: ${15 * scale}px;
                                font-weight: bold;
                                text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
                            ">${answerEl.textContent}</div>
                        </div>
                    </div>
                </div>
                <div style="
                    background: linear-gradient(135deg, #e9d5ff 0%, #ddd6fe 100%);
                    padding: 25px;
                    border-radius: 15px;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    border: 2px solid #c4b5fd;
                    margin: 0;
                ">
                    <div style="
                        font-size: 0.9em;
                        color: #6d28d9;
                        font-weight: bold;
                        margin-bottom: 10px;
                        text-align: center;
                    ">From The Book of Carp:</div>
                    <div style="
                        font-size: 1.1em;
                        font-style: italic;
                        color: #4c1d95;
                        line-height: 1.6;
                        text-align: center;
                    ">${quoteText.textContent}</div>
                </div>
            `;
            
            document.body.appendChild(card);
            
            // Use html2canvas library
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
            script.onload = async () => {
                currentCanvas = await html2canvas(card, {
                    backgroundColor: null,
                    scale: 2
                });
                
                // Show preview
                const previewImage = document.getElementById('previewImage');
                previewImage.innerHTML = '';
                previewImage.appendChild(currentCanvas);
                
                document.getElementById('previewModal').classList.add('visible');
                document.body.removeChild(card);
            };
            document.head.appendChild(script);
        }
        
        function downloadScreenshot() {
            if (currentCanvas) {
                currentCanvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'magic-8-ball-prediction.png';
                    a.click();
                    URL.revokeObjectURL(url);
                });
                closePreview();
            }
        }

        async function copyToClipboard() {
            if (currentCanvas) {
                try {
                    currentCanvas.toBlob(async (blob) => {
                        await navigator.clipboard.write([
                            new ClipboardItem({
                                'image/png': blob
                            })
                        ]);
                        
                        // Show feedback
                        const btn = event.target;
                        const originalText = btn.innerHTML;
                        btn.innerHTML = 'âœ… Copied!';
                        btn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                        
                        setTimeout(() => {
                            btn.innerHTML = originalText;
                            btn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                        }, 2000);
                    });
                } catch (err) {
                    alert('Failed to copy to clipboard. Please try downloading instead.');
                    console.error('Copy failed:', err);
                }
            }
        }
        
        function closePreview(event) {
            if (event) {
                // Only close if clicking the modal backdrop, not the content
                if (event.target.id !== 'previewModal') return;
            }
            document.getElementById('previewModal').classList.remove('visible');
            currentCanvas = null;
        }
        
        function downloadScreenshot() {
            if (currentCanvas) {
                currentCanvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'magic-8-ball-prediction.png';
                    a.click();
                    URL.revokeObjectURL(url);
                });
                closePreview();
            }
        }
        
        function closePreview(event) {
            if (event) {
                // Only close if clicking the modal backdrop, not the content
                if (event.target.id !== 'previewModal') return;
            }
            document.getElementById('previewModal').classList.remove('visible');
            currentCanvas = null;
        }

        // Allow pressing Enter to ask question
        document.getElementById('question').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                askQuestion();
            }
        });
    </script>
</body>
</html>
