<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booster Pack Generator</title>
    <style>
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: url('shrekbg.jpg') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            width: 100%;
        }
        h1 {
            color: #d4af37;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            font-size: 2.5em;
        }
        .pack-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            min-height: 500px;
        }
        .card {
            width: 220px;
            height: 340px;
            background: linear-gradient(135deg, #3a2f1f 0%, #2a2315 100%);
            border-radius: 12px;
            padding: 0;
            position: relative;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-10px) scale(1.05);
        }
        .card.reveal {
            animation: cardReveal 0.6s ease-out;
        }
        @keyframes cardReveal {
            0% {
                opacity: 0;
                transform: rotateY(90deg) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: rotateY(0deg) scale(1);
            }
        }
        .card-border {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            padding: 3px;
            pointer-events: none;
        }
        .card-border.common { background: linear-gradient(135deg, #9d9d9d, #7a7a7a); }
        .card-border.uncommon { background: linear-gradient(135deg, #1eff00, #15c900); }
        .card-border.rare { background: linear-gradient(135deg, #0070dd, #005bb5); }
        .card-border.epic { background: linear-gradient(135deg, #a335ee, #8a2ac7); }
        .card-border.legendary { background: linear-gradient(135deg, #c8a165, #a67c52);  }
        .card-content {
            position: relative;
            background: linear-gradient(135deg, #3a2f1f 0%, #2a2315 100%);
            border-radius: 10px;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 12px;
        }
        .card-header {
            text-align: center;
            margin-bottom: 10px;
        }
        .card-rarity {
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        .card-rarity.common { color: #9d9d9d; }
        .card-rarity.uncommon { color: #1eff00; }
        .card-rarity.rare { color: #0070dd; }
        .card-rarity.epic { color: #a335ee; }
        .card-rarity.legendary { color: #ff8000; }
        .card-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
            line-height: 1.2;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card-art {
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.3) 100%);
            border: 2px solid #444;
            border-radius: 8px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .card-art::before {
            content: attr(data-emoji);
            opacity: 0.3;
            font-size: 1.5em;
        }
        .card-stats {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #555;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 0.85em;
        }
        .stat-line {
            display: flex;
            justify-content: space-between;
            color: #00ff00;
            margin: 3px 0;
        }
        .stat-label {
            color: #aaa;
        }
        .card-description {
            flex-grow: 1;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #555;
            border-radius: 6px;
            padding: 8px;
            font-size: 0.75em;
            color: #ccc;
            font-style: italic;
            margin-bottom: 8px;
        }
        .card-value {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid #d4af37;
            border-radius: 6px;
            padding: 6px;
            text-align: center;
            font-size: 0.8em;
            color: #d4af37;
            font-weight: bold;
        }
        button {
            display: block;
            margin: 0 auto;
            padding: 18px 40px;
            background: linear-gradient(135deg, #7a9b3a 0%, #a8c256 100%);
            border: 3px solid #5a6b2a;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #fff;
            box-shadow: 0 4px 15px rgba(122, 155, 58, 0.4);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(122, 155, 58, 0.6);
        }
        button:active {
            transform: translateY(0);
        }
        .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 0.9em;
            text-align: center;
            padding: 20px;
        }
        .sealed-pack {
            position: relative;
            width: 260px;
            height: 360px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: packPulse 1.6s ease-in-out infinite;
        }
        
        .pack-image {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            transition: transform 0.3s ease, opacity 0.5s ease;
        }
        
        .click-text {
            margin-top: 10px;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
        }
        
        @keyframes packPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .pack-opening {
            animation: openPackAnim 0.8s ease forwards;
        }
        
        @keyframes openPackAnim {
            0% { opacity: 1; transform: scale(1) rotate(0); }
            100% { opacity: 0; transform: scale(1.2) rotate(8deg); }
        }
        
        .card-back-stack {
            width: 220px;
            height: 340px;
            position: relative;
            margin: auto;
            cursor: pointer;
        }
        
        .card-back {
            position: absolute;
            width: 220px;
            height: 340px;
        
            background-image: url('./cardbackshr.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        
            border-radius: 12px;
            border: 3px solid #444;
        
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        
            transition: opacity 0.4s ease, transform 0.4s ease;
            cursor: pointer;
        }


        
        .card-back:nth-child(1) { transform: rotate(-3deg) translateY(-6px); }
        .card-back:nth-child(2) { transform: rotate(2deg) translateY(-3px); }
        .card-back:nth-child(3) { transform: rotate(-1deg); }

        .rarity-common {
            box-shadow: 0 0 12px 2px rgba(150,150,150,0.4);
        }
        
        .rarity-uncommon {
            box-shadow: 0 0 14px 3px rgba(30,255,0,0.55);
        }
        
        .rarity-rare {
            box-shadow: 0 0 16px 4px rgba(0,110,255,0.6);
        }
        
        .rarity-epic {
            box-shadow: 0 0 18px 5px rgba(163,53,238,0.7);
        }
        
        .rarity-legendary {
            box-shadow: 0 0 22px 6px rgba(255,128,0,0.85);
        }
        .card-back::before,
        .card-back::after {
            content: none !important;
        }    
        
        /* --- CARD FLIP/PLACEMENT/HOVER RULES (FIXED) --- */
        .flip-card {
            width: 220px;
            height: 340px;
            perspective: 1200px;
            cursor: default;
            position: absolute;    
            z-index: 10;
            /* Define CSS Variables to store the final computed position */
            --final-x: 0px; 
            --final-y: 0px; 
            --final-r: 0deg; 
        }
        
        .flip-card.can-flip {
            cursor: pointer;
        }

        /* Apply floating animation when cards are in place */
        .flip-card.idle-float {
            /* Ensure the float animation uses its own transform */
            animation: cardFloat 3s ease-in-out infinite;
            /* Combine the final static position with the float */
            transform: translate(var(--final-x), var(--final-y)) rotate(var(--final-r));
        }

        /* Hover effect to lift card above others */
        .flip-card.can-flip:hover {
            z-index: 100;
            /* The key fix: Re-apply the static position (CSS variables) + the lift/scale */
            transform: translate(var(--final-x), var(--final-y)) translateY(-20px) scale(1.08) rotate(var(--final-r));
            animation: none; /* Temporarily stop the idle-float animation on hover */
        }

        .flip-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.7s ease;
            transform-style: preserve-3d;
        }
        
        .flip-card.flipped .flip-inner {
            transform: rotateY(180deg);
        }
        
        .flip-front,
        .flip-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;    
            border-radius: 12px;
        }
        
        .flip-back {
            background-image: url('./cardbackshr.png');    
            background-size: cover;
            background-position: center;
        }
        
        .flip-front {
            transform: rotateY(180deg);    
        }
        /* --- HOLOGRAPHIC SHINE EFFECT (NEW BLOCK) --- */
        .holographic-shine {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            opacity: 0;
            border-radius: 10px;
            z-index: 10;
            
            mix-blend-mode: screen;
        }
        
        .flip-card.flipped .holographic-shine.is-holo {
            opacity: 0.3;
            transition: opacity 0.5s ease 0.7s;    
        }
        
        .holographic-shine {
            background: linear-gradient(
                90deg,
                rgba(255, 0, 0, 1) 0%,
                rgba(255, 154, 0, 1) 10%,
                rgba(208, 222, 33, 1) 20%,
                rgba(79, 220, 74, 1) 30%,
                rgba(63, 218, 216, 1) 40%,
                rgba(47, 201, 226, 1) 50%,
                rgba(28, 110, 218, 1) 60%,
                rgba(100, 20, 200, 1) 70%,
                rgba(200, 30, 150, 1) 80%,
                rgba(255, 0, 0, 1) 100%
            );
            background-size: 500% 100%;
            background-position: 100% 0;
            animation: holo-shine 15s linear infinite;
        }
        
        @keyframes holo-shine {
            0% {
                background-position: 100% 0;
            }
            100% {
                background-position: 0% 0;
            }
        }

        @keyframes cardFloat {
            0%, 100% {
                transform: translate(var(--final-x), var(--final-y)) translateY(0px) rotate(var(--final-r));
            }
            50% {
                transform: translate(var(--final-x), var(--final-y)) translateY(-10px) rotate(var(--final-r));
            }
        }
        /* Radial pulse effect for unflipped rare+ cards */
        .flip-card.can-flip:not(.flipped)::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            transition: all 0.6s ease-out;
        }
        
        .flip-card.can-flip.rarity-rare:not(.flipped):hover::before {
            width: 300px;
            height: 300px;
            opacity: 0.4;
            background: radial-gradient(circle, rgba(0,112,221,0.6) 0%, rgba(0,91,181,0.3) 50%, transparent 70%);
        }
        
        .flip-card.can-flip.rarity-epic:not(.flipped):hover::before {
            width: 300px;
            height: 300px;
            opacity: 0.5;
            background: radial-gradient(circle, rgba(163,53,238,0.7) 0%, rgba(138,42,199,0.4) 50%, transparent 70%);
        }
        
        .flip-card.can-flip.rarity-legendary:not(.flipped):hover::before {
            width: 320px;
            height: 320px;
            opacity: 0.6;
            background: radial-gradient(circle, rgba(255,128,0,0.8) 0%, rgba(255,200,0,0.5) 40%, rgba(204,102,0,0.3) 60%, transparent 75%);
            animation: legendaryPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes legendaryPulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.6;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pack-container" id="packContainer">
            <div id="sealedPack" class="sealed-pack">
                <img src='./shrekpack.jpg' alt="Booster Pack" class="pack-image">
            <div class="click-text">Click to open</div>
            </div>
        </div>

        <button id="resetButton" onclick="resetPack()" style="display: none;">Do it ogre again</button>
    </div>

    <script>
        const data = {
            rarities: ['COMMON', 'UNCOMMON', 'RARE', 'EPIC', 'LEGENDARY'],
            
            commonPrefixes: ['Worn', 'Old', 'Simple', 'Basic', 'Plain', 'Crude', 'Rusty', 'Dull', 'Chipped', 'Tarnished'],
            uncommonPrefixes: ['Sturdy', 'Fine', 'Quality', 'Polished', 'Sharp', 'Reinforced', 'Balanced', 'Crafted', 'Solid', 'Reliable'],
            rarePrefixes: ['Blessed', 'Enhanced', 'Superior', 'Enchanted', 'Radiant', 'Gleaming', 'Masterwork', 'Exquisite', 'Pristine', 'Glorious'],
            epicPrefixes: ['Ancient', 'Divine', 'Celestial', 'Eternal', 'Supreme', 'Mythic', 'Transcendent', 'Ascendant', 'Hallowed', 'Majestic'],
            
            items: ['Darts', 'Sword', 'Shield', 'Amulet', 'Ring', 'Helmet', 'Boots', 'Gauntlets', 'Cloak', 'Staff', 'Blade', 'Axe', 'Bow', 'Wand', 'Orb'],
            
            rareSuffixes: [
              'of the Onion', 'of the Swamp', 'of the Donkey', 'of the Ogre', 'of the Gingerbread', 'of the Dragoness', 'of the Muffin Man', 'of Farquaad',
              'of Fiona', 'of Shrek', 'of the Three Blind Mice', 'of the Big Bad Wolf', 'of the Magic Mirror', 'of the Pinocchio', 'of the Dronkeys', 'of the King Harold'
            ],
            
            epicSuffixes: [
              'of the Noble Steed', 'of the Duloc Knight', 'of the Fairy Godmother', 'of the Royal Ogre', 'of the Swamp Champion', 'of the Onion Sage', 'of the Gingerbread General', 'of the Far Far Away Paladin',
              'of the Dragon', 'of the Queen Lillian', 'of the Prince Charming', 'of the Mongo', 'of the Doris', 'of the Captain Hook', 'of the Fairy Tale Creatures', 'of the Happily Ever After'
            ],
            
            legendaryPart1: [
              'Void', 'Star', 'Soul', 'Death', 'Life', 'Storm', 'Shadow', 'Light', 'Frost', 'Flame', 'Blood', 'Dawn', 'Dusk', 'Moon', 'Sun',
              'Onion', 'Swamp', 'Donkey', 'Dragon', 'Ogre', 'Duloc', 'Farquaad', 'Gingy', 'Fiona', 'Fairy', 'Muffin', 'Steed', 'Shrek', 'Puss'
            ],
            
            legendaryPart2: [
              'bringer', 'reaver', 'render', 'fang', 'claw', 'seeker', 'fury', 'bane', 'heart', 'breaker', 'singer', 'caller', 'weaver', 'forged',
              'smasher', 'muncher', 'stomper', 'howler', 'kicker', 'whisperer', 'baker', 'screamer', 'rider', 'trickster', 'spinner', 'chomper', 'singer', 'slayer'
            ],

            
            stats: ['NOM', 'SHAME', 'GLORY', 'POWER', 'SPEED', 'WISDOM', 'CHAOS', 'ORDER', 'LUCK', 'GRIT'],
            comparisons: ['chocolate', 'velvet', 'marble', 'glass', 'steel', 'silk', 'smoke', 'lightning', 'water', 'fire', 'ice', 'stone', 'wood', 'gold'],

            spellPrefixes: [
              "Shrek's", "Fiona's", "Donkey's", "Dragon's", "Mongo's", "Gingy's", "Farquaad's",
              "Onion's", "Swamp's", "Dronkeys'", "Fairy Godmother's", "Pinocchio's",
              "Big Bad Wolf's", "Three Blind Mice's"
            ],

            spellSuffixes: [
                          "Fury", "Storm", "Wrath", "Blessing", "Curse", "Charm", "Hex", "Song",
                          "Dance", "Roar", "Whisper", "Shimmer", "Howl", "Feast", "Trial"
                        ],
        };

        const shrekEmojis = ['üßÖ','üê∏','üê¥','üêâ','üëπ','üç™','üëë','ü™Ñ','üå≥','üè∞','üê±','ü•õ','üåÖ','üé§','üíÉ','üõ°Ô∏è','üî•','üåå','üçª','üòÇ'];

        function random(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function pick(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function pickRarity() {
            const roll = Math.random() * 100;
            
            if (roll < 50) return 'COMMON';
            if (roll < 75) return 'UNCOMMON';
            if (roll < 90) return 'RARE';
            if (roll < 97) return 'EPIC';
            return 'LEGENDARY';
        }

        function generateItem() {
            const rarity = pickRarity();
            
            let name;
            switch(rarity) {
                case 'COMMON':
                    name = `${pick(data.commonPrefixes)} ${pick(data.items)}`;
                    break;
                case 'UNCOMMON':
                    name = `${pick(data.uncommonPrefixes)} ${pick(data.items)}`;
                    break;
                case 'RARE':
                    name = `${pick(data.rarePrefixes)} ${pick(data.items)} ${pick(data.rareSuffixes)}`;
                    break;
                case 'EPIC':
                    name = `${pick(data.epicPrefixes)} ${pick(data.items)} ${pick(data.epicSuffixes)}`;
                    break;
                case 'LEGENDARY':
                    name = `${pick(data.legendaryPart1)}${pick(data.legendaryPart2)}`;
                    break;
            }
            
            const stat1 = pick(data.stats);
            const stat1Value = random(-5, 20);
            const stat1Sign = stat1Value >= 0 ? '+' : '';
            
            let stat2 = pick(data.stats);
            while (stat2 === stat1) {
                stat2 = pick(data.stats);
            }
            const stat2Value = random(-5, 20);
            const stat2Sign = stat2Value >= 0 ? '+' : '';
            
            const comparison = pick(data.comparisons);
            
            let gold, silver, copper;
            switch(rarity) {
                case 'COMMON':
                    gold = 0;
                    silver = random(0, 5);
                    copper = random(0, 99);
                    break;
                case 'UNCOMMON':
                    gold = random(0, 2);
                    silver = random(0, 99);
                    copper = random(0, 99);
                    break;
                case 'RARE':
                    gold = random(3, 25);
                    silver = random(0, 99);
                    copper = random(0, 99);
                    break;
                case 'EPIC':
                    gold = random(26, 150);
                    silver = random(0, 99);
                    copper = random(0, 99);
                    break;
                case 'LEGENDARY':
                    gold = random(151, 999);
                    silver = random(0, 99);
                    copper = random(0, 99);
                    break;
            }
            
            const isHolographic = Math.random() < 0.08; // 8% chance (roughly 1 in 2.5 packs of 6 cards)

            return {
                rarity,
                name,
                stat1,
                stat1Value,
                stat1Sign,
                stat2,
                stat2Value,
                stat2Sign,
                comparison,
                gold,
                silver,
                copper,
                isHolographic
            };
        }

        function createCard(item, delay) {
            const rarityClass = item.rarity.toLowerCase();
            
            const card = document.createElement('div');
            card.className = 'card';
            card.style.animationDelay = `${delay}s`;
            
            setTimeout(() => {
                card.classList.add('reveal');
            }, delay * 1000);
            
            card.innerHTML = `
                <div class="card-border ${rarityClass}">
                    <div class="holographic-shine ${item.isHolographic ? 'is-holo' : ''}"></div>
                    <div class="card-content">
                        <div class="card-header">
                            <div class="card-rarity ${rarityClass}">${item.rarity}</div>
                            <div class="card-name">${item.name}</div>
                        </div>
                        <div class="card-art" data-emoji="${pick(shrekEmojis)}"></div>
                        <div class="card-stats">
                            <div class="stat-line">
                                <span class="stat-label">${item.stat1}</span>
                                <span style="color: ${item.stat1Value >= 0 ? '#00ff00' : '#ff0000'}">${item.stat1Sign}${item.stat1Value}</span>
                            </div>
                            <div class="stat-line">
                                <span class="stat-label">${item.stat2}</span>
                                <span style="color: ${item.stat2Value >= 0 ? '#00ff00' : '#ff0000'}">${item.stat2Sign}${item.stat2Value}</span>
                            </div>
                        </div>
                        <div class="card-description">
                            It looks kind of like ${item.comparison}.
                        </div>
                        <div class="card-value">
                            ${item.gold}g ${item.silver}s ${item.copper}c
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        let packOpened = false;
        let backsRevealed = false;
        
        document.getElementById("sealedPack").addEventListener("click", () => {
            if (packOpened) return;
        
            packOpened = true;
            const sealed = document.getElementById("sealedPack");
        
            sealed.classList.add("pack-opening");
        
            setTimeout(() => {
                sealed.remove();
                showCardBacks();
                document.getElementById('resetButton').style.display = 'block';
            }, 800);
        });
        
        let generatedItems = [];

        function showCardBacks() {
            const container = document.getElementById("packContainer");
        
            generatedItems = [];
            for (let i = 0; i < 6; i++) {
                generatedItems.push(generateItem());
            }
        
            container.innerHTML = "";
        
            const fanPositions = [
                { x: -325, y: -25, r: -10 },
                { x: -195, y: -5, r: -6 },
                { x: -65, y: 10, r: -2 },
                { x: 65, y: 10, r: 2 },
                { x: 195, y: -5, r: 6 },
                { x: 325, y: -25, r: 10 }
            ];

            const finalPositions = [
                { x: -600, y: -35, r: -4 },
                { x: -360, y: -15, r: -2 },
                { x: -120, y: 0, r: -1 },
                { x: 120, y: 0, r: 1 },
                { x: 360, y: -15, r: 2 },
                { x: 600, y: -35, r: 4 }
            ];
        
            const backWrapper = document.createElement("div");
            backWrapper.style.position = "relative";
            backWrapper.style.width = "100%";
            backWrapper.style.height = "450px";
            backWrapper.style.display = "flex";
            backWrapper.style.alignItems = "center";
            backWrapper.style.justifyContent = "center";
            container.appendChild(backWrapper);
            
            const FAN_SPREAD_INTERVAL = 120;
            const FAN_SPREAD_DURATION = 700;
            const PLACEMENT_DURATION = 500;
            
            const FAN_END_TIME = (generatedItems.length * FAN_SPREAD_INTERVAL) + FAN_SPREAD_DURATION;
            const FINAL_PLACEMENT_END_TIME = FAN_END_TIME + PLACEMENT_DURATION + 100;
        
            generatedItems.forEach((item, i) => {
                const rarityClass = item.rarity.toLowerCase();
        
                const wrapper = document.createElement("div");
                wrapper.className = `flip-card rarity-${rarityClass}`;
                wrapper.style.position = "absolute";
                wrapper.style.opacity = "0";
                wrapper.style.transform = "translate(0,0) rotate(0deg)";
                wrapper.style.transition = `all ${FAN_SPREAD_DURATION/1000}s ease`;
                
                const inner = document.createElement("div");
                inner.className = "flip-inner";
                
                const flipBack = document.createElement("div");
                flipBack.className = "flip-back";
                
                const flipFront = document.createElement("div");
                flipFront.className = "flip-front";
                flipFront.appendChild(createCard(item, 0));    
                
                inner.appendChild(flipBack);
                inner.appendChild(flipFront);
                wrapper.appendChild(inner);
                backWrapper.appendChild(wrapper);
                
                const flipCard = () => {
                    if (!wrapper.classList.contains('can-flip')) return;
                    
                    wrapper.removeEventListener('click', flipCard);    
                    wrapper.classList.add("flipped");
                
                    if (!backsRevealed) {
                        backsRevealed = true;
                    }
                };
                
                // Auto-flip common and uncommon cards
                if (rarityClass === 'common' || rarityClass === 'uncommon') {
                    setTimeout(() => {
                        wrapper.classList.add("flipped");
                    }, FINAL_PLACEMENT_END_TIME + 300 + (i * 200)); // Stagger the auto-flips
                } else {
                    // Only rare, epic, and legendary can be clicked
                    wrapper.addEventListener("click", flipCard);
                }
                
                // === STAGE 1: FAN SPREAD ===
                setTimeout(() => {
                    wrapper.style.opacity = "1";
                    wrapper.style.transform =
                        `translate(${fanPositions[i].x}px, ${fanPositions[i].y}px) rotate(${fanPositions[i].r}deg)`;
                }, 50 + i * FAN_SPREAD_INTERVAL);
                
                // === STAGE 2: FINAL PLACEMENT ===
                setTimeout(() => {
                    wrapper.style.transition = `all ${PLACEMENT_DURATION/1000}s ease-in-out`;

                    // Set CSS variables for the final position/rotation
                    wrapper.style.setProperty('--final-x', `${finalPositions[i].x}px`);
                    wrapper.style.setProperty('--final-y', `${finalPositions[i].y}px`);
                    wrapper.style.setProperty('--final-r', `${finalPositions[i].r}deg`);

                    // Apply final position using explicit transform for this step
                    wrapper.style.transform =
                        `translate(${finalPositions[i].x}px, ${finalPositions[i].y}px) rotate(${finalPositions[i].r}deg)`;
                }, FAN_END_TIME);
            });
        
            // === STAGE 3: ENABLE FLIPPING ===
            setTimeout(() => {
                document.querySelectorAll('.flip-card').forEach(card => {
                    card.classList.add('can-flip');
                    card.classList.add('idle-float');
                    card.style.transition = `all 0.7s ease`;    
                });
            }, FINAL_PLACEMENT_END_TIME);
        }
        
        function openPack() {
            const container = document.getElementById('packContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const item = generateItem();
                const card = createCard(item, i * 0.15);
                container.appendChild(card);
            }
        }

        async function loadDataFromFiles() {
            const files = [
                'rarities',    
                'commonPrefixes', 'uncommonPrefixes', 'rarePrefixes', 'epicPrefixes',
                'items',    
                'rareSuffixes', 'epicSuffixes',
                'legendaryPart1', 'legendaryPart2',
                'stats', 'comparisons'
            ];
            
            for (const file of files) {
                try {
                    const response = await fetch(`names/${file}.txt`);
                    if (response.ok) {
                        const text = await response.text();
                        data[file] = text.split('\n').filter(line => line.trim());
                    }
                } catch (e) {
                    console.log(`Could not load ${file}.txt, using defaults`);
                }
            }
        }

        function resetPack() {
            packOpened = false;
            backsRevealed = false;
            generatedItems = [];
        
            const container = document.getElementById("packContainer");
            container.innerHTML = `
                <div id="sealedPack" class="sealed-pack">
                    <img src="./shrekpack.jpg" alt="Booster Pack" class="pack-image">
                    <div class="click-text">Click to open</div>
                </div>
            `;
        
            document.getElementById("sealedPack").addEventListener("click", () => {
                if (packOpened) return;
        
                packOpened = true;
                const sealed = document.getElementById("sealedPack");
                sealed.classList.add("pack-opening");
        
                setTimeout(() => {
                    sealed.remove();
                    showCardBacks();
                    document.getElementById('resetButton').style.display = 'block';
                }, 800);
            });
        }


        loadDataFromFiles();
    </script>
</body>
</html>
