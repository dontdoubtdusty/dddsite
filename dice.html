<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Shrek Dice</title>
  <style>
    body {
      display: flex;
	  justify-content: center;
	  align-items: center;
	  gap: 80px;
      height: 100vh;
      margin: 0;
      background-image: url('shreks-swamp.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #000;
      position: relative;
      overflow: hidden;
    }
    
    body::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, rgba(45, 74, 43, 0.85) 0%, rgba(26, 46, 26, 0.85) 30%, rgba(13, 31, 13, 0.85) 60%, rgba(0, 0, 0, 0.85) 100%);
      pointer-events: none;
      z-index: 0;
    }
    
    body > * {
      position: relative;
      z-index: 1;
    }
    
    #dice-container {
      width: 150px;
      height: 150px;
      perspective: 800px;
      cursor: pointer;
      transition: transform 0.1s;
    }

    #dice-container::after {
      content: '';
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 20px;
      background: radial-gradient(ellipse, rgba(0, 0, 0, 0.4) 0%, transparent 70%);
      border-radius: 50%;
      transition: all 0.1s;
    }
    
    #dice-container.tossing {
      animation: diceToss 1.8s ease-in-out;
    }

    #dice-container.tossing::after {
      animation: shadowShrink 1.8s ease-in-out;
    }     

    @keyframes shadowShrink {
      0% {
        width: 120px;
        opacity: 0.4;
      }
      25% {
        width: 60px;
        opacity: 0.15;
      }
      50% {
        width: 40px;
        opacity: 0.1;
      }
      75% {
        width: 80px;
        opacity: 0.25;
      }
      100% {
        width: 120px;
        opacity: 0.4;
      }
    }
    #cube {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 1s;
    }
    .face {
      position: absolute;
      width: 150px;
      height: 150px;
      border: 2px solid #a0a0a0;
      display: grid;
      padding: 8px;
      gap: 3px;
      box-sizing: border-box;
    }
    .face img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .face.one { 
      grid-template: 1fr / 1fr; 
      place-items: center;
    }
    
    .face.two { 
      display: grid;
      grid-template-areas: 
        "a . ."
        ". . ."
        ". . b";
      grid-template-rows: 1fr 1fr 1fr;
      grid-template-columns: 1fr 1fr 1fr;
    }
    
    .face.three { 
      display: grid;
      grid-template-areas: 
        "a . ."
        ". b ."
        ". . c";
      grid-template-rows: 1fr 1fr 1fr;
      grid-template-columns: 1fr 1fr 1fr;
    }
    
    .face.four { 
      grid-template: 1fr 1fr / 1fr 1fr; 
    }
    
    .face.five { 
      display: grid;
      grid-template-areas: 
        "a . b"
        ". c ."
        "d . e";
      grid-template-rows: 1fr 1fr 1fr;
      grid-template-columns: 1fr 1fr 1fr;
    }
    
    .face.six {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      padding: 8px;
      gap: 3px;
    }
    
    .face.six img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    

    .front  { transform: rotateY(0deg)    translateZ(75px);  background: #689f38; }
    .back   { transform: rotateY(180deg)  translateZ(75px);  background: #689f38; }
    .right  { transform: rotateY(90deg)   translateZ(75px);  background: #689f38; }
    .left   { transform: rotateY(-90deg)  translateZ(75px);  background: #689f38; }
    .top    { transform: rotateX(90deg)   translateZ(75px);  background: #689f38; }
    .bottom { transform: rotateX(-90deg)  translateZ(75px);  background: #689f38; }


    .tint-red img { filter: sepia(100%) saturate(500%) hue-rotate(-50deg) brightness(0.8); }
    .tint-blue img { filter: sepia(100%) saturate(500%) hue-rotate(180deg) brightness(0.9); }
    .tint-green img { filter: sepia(100%) saturate(500%) hue-rotate(60deg) brightness(1); }
    .tint-purple img { filter: sepia(100%) saturate(500%) hue-rotate(260deg) brightness(0.9); }
    .tint-orange img { filter: sepia(100%) saturate(500%) hue-rotate(10deg) brightness(1.1); }
    .tint-pink img { filter: sepia(100%) saturate(300%) hue-rotate(300deg) brightness(1.2); }

    #rolls-panel {
	  background: rgba(13, 31, 13, 0.9);
	  border: 3px solid #7cfc00;
	  border-radius: 15px;
	  padding: 20px;
	  width: 280px;
	  max-height: 80vh;
	  overflow-y: auto;
	  box-shadow: 0 0 20px rgba(124, 252, 0, 0.3);
	}
	
	#rolls-panel h2 {
	  color: #7cfc00;
	  font-family: 'Arial Black', sans-serif;
	  text-align: center;
	  margin: 0 0 15px 0;
	  font-size: 24px;
	  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
	}
	
	#current-result {
	  color: #7cfc00;
	  font-size: 28px;
	  font-weight: bold;
	  font-family: 'Arial Black', sans-serif;
	  text-align: center;
	  margin-bottom: 20px;
	  min-height: 35px;
	  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
	}
	
	#rolls-list {
	  color: #7cfc00;
	  font-size: 16px;
	  font-family: Arial;
	}
	
	#rolls-list > div {
	  padding: 8px;
	  margin-bottom: 8px;
	  background: rgba(0, 0, 0, 0.3);
	  border-radius: 5px;
	  border-left: 3px solid #7cfc00;
	}

    @keyframes shake {
      0%   { transform: translateX(0) translateY(0) rotateZ(0deg); }
      10%  { transform: translateX(-4px) translateY(2px) rotateZ(-2deg); }
      20%  { transform: translateX(3px) translateY(-3px) rotateZ(1deg); }
      30%  { transform: translateX(-2px) translateY(4px) rotateZ(-2deg); }
      40%  { transform: translateX(4px) translateY(-2px) rotateZ(2deg); }
      50%  { transform: translateX(-3px) translateY(-3px) rotateZ(-1deg); }
      60%  { transform: translateX(2px) translateY(3px) rotateZ(2deg); }
      70%  { transform: translateX(-3px) translateY(-2px) rotateZ(-1deg); }
      80%  { transform: translateX(2px) translateY(3px) rotateZ(1deg); }
      90%  { transform: translateX(-1px) translateY(-2px) rotateZ(-1deg); }
      100% { transform: translateX(0) translateY(0) rotateZ(0deg); }
    }
    
    .shaking {
      animation: shake 0.3s ease;
    }
    .particle {
      position: absolute;
      width: 20px;        /* Bigger size */
      height: 20px;       /* Bigger size */
      background: radial-gradient(circle, #90ff00 0%, #7cfc00 30%, #228b22 100%);  /* More gradient layers for bubble effect */
      border-radius: 50%;
      pointer-events: none;
      animation: float-up 2s ease-out forwards;
      opacity: 0.8;
      box-shadow: inset -3px -3px 8px rgba(0, 0, 0, 0.3),   /* Inner shadow for depth */
                  inset 3px 3px 8px rgba(255, 255, 255, 0.4),  /* Highlight for shine */
                  0 0 10px rgba(124, 252, 0, 0.5);              /* Outer glow */
    }
    
    @keyframes float-up {
      0% {
        transform: translateY(0) translateX(0) scale(1);
        opacity: 0.7;
      }
      100% {
        transform: translateY(-200px) translateX(var(--drift)) scale(0);
        opacity: 0;
      }
    }

    @keyframes diceToss {
      0% {
        transform: translateY(0) scale(1);
      }
      25% {
        transform: translateY(-80px) scale(1.1);
      }
      50% {
        transform: translateY(-100px) scale(1.15);
      }
      75% {
        transform: translateY(-60px) scale(1.05);
      }
      100% {
        transform: translateY(0) scale(1);
      }
    }
	  
	@keyframes fadeIn {
	  from { opacity: 0; }
	  to { opacity: 1; }
	}
	#username-picker {
	  position: fixed;
	  top: 20px;
	  left: 50%;
	  transform: translateX(-50%);
	  z-index: 100;
	  display: flex;
	  gap: 10px;
	  align-items: center;
	  background: rgba(13, 31, 13, 0.95);
	  padding: 15px 25px;
	  border-radius: 10px;
	  border: 2px solid #7cfc00;
	  box-shadow: 0 0 15px rgba(124, 252, 0, 0.3);
	}
	
	#username-picker label {
	  color: #7cfc00;
	  font-family: 'Arial Black', sans-serif;
	  font-size: 14px;
	  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
	}
	
	#username-picker select {
	  background: rgba(0, 0, 0, 0.5);
	  color: #7cfc00;
	  border: 2px solid #7cfc00;
	  border-radius: 5px;
	  padding: 5px 10px;
	  font-family: Arial, sans-serif;
	  font-size: 14px;
	  cursor: pointer;
	}
	
	#username-picker select:focus {
	  outline: none;
	  box-shadow: 0 0 10px rgba(124, 252, 0, 0.5);
	}

  </style>
</head>
<body>
  <div id="username-picker">
	  <label>Username:</label>
	  <select id="adjective-select">
		  <option value="Lucky">Lucky</option>
		  <option value="Unlucky">Unlucky</option>
		  <option value="Blessed">Blessed</option>
		  <option value="Cursed">Cursed</option>
		  <option value="Risky">Risky</option>
		  <option value="Golden">Golden</option>
		  <option value="Swampy">Swampy</option>
		  <option value="Ogre">Ogre</option>
		  <option value="Onion">Onion</option>
		  <option value="Layered">Layered</option>
		  <option value="Muddy">Muddy</option>
		  <option value="Stinky">Stinky</option>
	  </select>
	  <select id="character-select">
	    <option value="Shrek">Shrek</option>
	    <option value="Fiona">Fiona</option>
	    <option value="Donkey">Donkey</option>
	    <option value="Puss">Puss</option>
	    <option value="Farquaad">Farquaad</option>
	    <option value="Dragon">Dragon</option>
	    <option value="Gingy">Gingy</option>
	    <option value="Pinocchio">Pinocchio</option>
	    <option value="BigBadWolf">BigBadWolf</option>
	    <option value="ThreePigs">ThreePigs</option>
	    <option value="BlindMice">BlindMice</option>
	  </select>
	</div>
  <div id="dice-container">
    <div id="cube">
      <div class="face front one">
        <img src="shrek_PNG.png" alt="">
      </div>
      <div class="face back six">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
      </div>
      <div class="face right three">
        <img src="shrek_PNG.png" alt="">
        <div></div>
        <div></div>
        <div></div>
        <img src="shrek_PNG.png" alt="">
        <div></div>
        <div></div>
        <div></div>
        <img src="shrek_PNG.png" alt="">
      </div>
      <div class="face left four">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
        <img src="shrek_PNG.png" alt="">
      </div>
      <div class="face top five">
      <img src="shrek_PNG.png" alt="">
      <div></div>
      <img src="shrek_PNG.png" alt="">
      <div></div>
      <img src="shrek_PNG.png" alt="">
      <div></div>
      <img src="shrek_PNG.png" alt="">
      <div></div>
      <img src="shrek_PNG.png" alt="">
    </div>
      <div class="face bottom two">
      <img src="shrek_PNG.png" alt="">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <img src="shrek_PNG.png" alt="">
    </div>
    </div>
  </div>
  <div id="result"></div>
  <div id="rolls-panel">
	  <h2>LAST 6 SHROLLS</h2>
	  <div id="current-result"></div>
	  <div id="rolls-list"></div>
	</div>
  
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <script>
    const cube = document.getElementById("cube");
    const result = document.getElementById("current-result");
    const diceContainer = document.getElementById("dice-container");

    const firebaseConfig = {
      databaseURL: "https://shrek-dice-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Username generator
	function generateUsername() {
	  const adjective = document.getElementById('adjective-select').value;
	  const character = document.getElementById('character-select').value;
	  const number = Math.floor(Math.random() * 100);
	  
	  return `${adjective}${character}${number}`;
	}

	function randomizeDropdowns() {
	  const adjectiveSelect = document.getElementById('adjective-select');
	  const characterSelect = document.getElementById('character-select');
	  
	  // Randomly select an adjective
	  const randomAdjectiveIndex = Math.floor(Math.random() * adjectiveSelect.options.length);
	  adjectiveSelect.selectedIndex = randomAdjectiveIndex;
	  
	  // Randomly select a character
	  const randomCharacterIndex = Math.floor(Math.random() * characterSelect.options.length);
	  characterSelect.selectedIndex = randomCharacterIndex;
	}
	
	// Then update your DOMContentLoaded event listener to call it:
	document.addEventListener('DOMContentLoaded', () => {
	  // Randomize the dropdowns on page load
	  randomizeDropdowns();
	  
	  // Then generate the username based on the random selections
	  userId = generateUsername();
	  
	  document.getElementById('adjective-select').addEventListener('change', () => {
	    userId = generateUsername();
	  });
	  
	  document.getElementById('character-select').addEventListener('change', () => {
	    userId = generateUsername();
	  });
	});
	
	// Generate initial username
	let userId = generateUsername();
	
	// Update username when dropdowns change
	document.addEventListener('DOMContentLoaded', () => {
	  document.getElementById('adjective-select').addEventListener('change', () => {
	    userId = generateUsername();
	  });
	  
	  document.getElementById('character-select').addEventListener('change', () => {
	    userId = generateUsername();
	  });
	});
    
    let allRolls = [];
    
    // Global tracking variables
    let currentRotationX = 0;
    let currentRotationY = 0;
    let isRolling = false; // Lock to prevent double clicks

    // Shuffle and assign colors to faces
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
    
    const colors = shuffleArray(['tint-red', 'tint-blue', 'tint-green', 'tint-purple', 'tint-orange', 'tint-pink']);
    
    // Apply random colors to faces
    document.querySelector('.face.front.one').classList.add(colors[0]);
    document.querySelector('.face.back.six').classList.add(colors[1]);
    document.querySelector('.face.right.three').classList.add(colors[2]);
    document.querySelector('.face.left.four').classList.add(colors[3]);
    document.querySelector('.face.top.five').classList.add(colors[4]);
    document.querySelector('.face.bottom.two').classList.add(colors[5]);

    function displayRolls() {
	  const rollsList = document.getElementById('rolls-list');
	  let html = '';
	  allRolls.slice(-6).reverse().forEach(roll => {
	    const seconds = Math.floor((Date.now() - roll.time) / 1000);
	    const hours = Math.floor(seconds / 3600);
	    const minutes = Math.floor((seconds % 3600) / 60);
	    const secs = seconds % 60;
	    
	    let timeAgo = '';
	    if (hours > 0) timeAgo += `${hours}h `;
	    if (minutes > 0) timeAgo += `${minutes}m `;
	    if (secs > 0 || timeAgo === '') timeAgo += `${secs}s`;
	    timeAgo = timeAgo.trim();
	    const userName = roll.user || 'Someone';
	    html += `<div>${userName} rolled ${roll.value} SHREK${roll.value === 1 ? '' : 'S'} (${timeAgo} ago)</div>`;
	  });
	  rollsList.innerHTML = html;
	}

    db.ref('rolls').limitToLast(10).on('value', (snapshot) => {
		  allRolls = [];
		  snapshot.forEach(child => {
		    allRolls.push(child.val());
		  });
		  displayRolls();
		});

    function saveRoll(value) {
      const roll = { 
        value: value, 
        time: Date.now(),
        user: userId 
      };
      db.ref('rolls').push(roll);
    }
    
    function randomRotation() {
      const rotations = [
        { x: 0, y: 0, value: 1 },    // front
        { x: 0, y: 180, value: 6 },  // back
        { x: 0, y: 90, value: 4 },   // right
        { x: 0, y: -90, value: 3 },  // left
        { x: -90, y: 0, value: 5 },  // top
        { x: 90, y: 0, value: 2 }    // bottom
      ];
      return rotations[Math.floor(Math.random() * rotations.length)];
    }
    
    // Helper to generate particles
    function spawnParticles() {
      for (let i = 0; i < 15; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          const startX = Math.random() * 150;
          const startY = Math.random() * 150;
          particle.style.left = startX + 'px';
          particle.style.top = startY + 'px';
          const drift = (Math.random() - 0.5) * 100;
          particle.style.setProperty('--drift', `${drift}px`);
          particle.style.animationDelay = `${Math.random() * 0.3}s`;
          diceContainer.appendChild(particle);
          setTimeout(() => particle.remove(), 2300);
        }
    }

    diceContainer.addEventListener("click", () => {
        if (isRolling) return; // Stop if already spinning
        isRolling = true;

        result.textContent = "";
        
        // 1. SOUND & PARTICLES
        const someSound = new Audio('SOME.wav');
        someSound.play().catch(e => console.log("Audio play failed"));
        spawnParticles();
        
        // 2. SHAKE START
        cube.classList.add("shaking");
        diceContainer.classList.add("tossing");
        
        // 3. AFTER SHAKE (300ms) -> TUMBLE PHASE
        setTimeout(() => {
          cube.classList.remove("shaking");

          // Add a random "Tumble" spin (between 360 and 720 degrees)
          // This ensures visually chaotic movement before targeting
          currentRotationX += Math.random() * 360 + 360;
          currentRotationY += Math.random() * 360 + 360;

          // Use 'linear' for the tumble so it looks like it's maintaining speed
          cube.style.transition = "transform 0.5s linear";
          cube.style.transform = `rotateX(${currentRotationX}deg) rotateY(${currentRotationY}deg)`;

          // 4. AFTER TUMBLE (500ms) -> LANDING PHASE
          setTimeout(() => {
            const { x, y, value } = randomRotation();
            
            // Calculate mathematical offset to land correctly
            const xOffset = x - (currentRotationX % 360);
            const yOffset = y - (currentRotationY % 360);
            
            // Add 2 extra spins (720) + the offset for the landing
            currentRotationX += 720 + xOffset;
            currentRotationY += 720 + yOffset;

            // Use 'cubic-bezier' for a nice slow-down landing effect
            cube.style.transition = "transform 1s cubic-bezier(0.2, 0.8, 0.2, 1)";
            cube.style.transform = `rotateX(${currentRotationX}deg) rotateY(${currentRotationY}deg)`;

            // 5. FINISH
            setTimeout(() => {
              const bodySound = new Audio('BODY.wav');
              bodySound.play().catch(e => console.log("Audio play failed"));
              
              result.textContent = `${value} SHREK${value === 1 ? '' : 'S'}!`;
			  saveRoll(value);
			  diceContainer.classList.remove("tossing");
              isRolling = false;
              
            }, 1000); // Wait for the 1s landing animation

          }, 450); // Slight overlap with previous time (500ms) prevents stutter
        }, 300); // Wait for Shake
    });
</script>
</body>
</html>
