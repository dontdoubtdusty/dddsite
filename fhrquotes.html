<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full House Reviewed Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 1. The Main Background (Pale Salmon/Peach) */
        body {
            background-color: #f4dcd6; /* Matches the side margins in your image */
            min-height: 100vh;
            font-family: 'Georgia', 'Times New Roman', serif; /* Classic serif font */
            color: #000000;
        }
    
        /* 2. The Content Container (White Column) */
        /* We redefine .parchment to look like the white paper in your image */
        .parchment {
            background: #ffffff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); /* Very subtle shadow */
            border: 1px solid #e5e5e5;
            border-radius: 0; /* Removing rounded corners for a sharper look */
        }
    
        /* 3. Typography & Overrides */
        /* Your HTML uses "text-purple-900". We override that here so you don't have to change the HTML tags */
        h1, h2, h3, 
        .text-purple-900, 
        .text-purple-700, 
        .text-purple-600 {
            color: #000000 !important; /* Force black text */
        }
    
        /* 4. Link Styling (Classic Blue) */
        a {
            color: #0000EE !important; /* Standard Internet Blue */
            text-decoration: underline;
        }
        
        a:hover {
            color: #551A8B !important; /* Visited/Hover purple style */
            text-decoration: none;
        }
    
        /* 5. Button Styling */
        /* Changing the purple buttons to black/grey to fit the cleaner look */
        button {
            background-image: none !important;
            background-color: #333333 !important;
            color: #ffffff !important;
            border: 1px solid #000000;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }
    
        button:hover {
            background-color: #000000 !important;
            transform: none !important; /* Remove the bounce effect for a serious tone */
        }
    
        /* 6. Search Input */
        input[type="text"] {
            background-color: #ffffff !important;
            border: 1px solid #cccccc !important;
            color: #000000 !important;
            border-radius: 4px !important;
        }
    
        /* Hide the decorative purple bar under the title */
        .bg-purple-900 {
            background-color: #000000 !important;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto" style="max-width: 700px; padding: 60px 24px;">
        <h1 
        class="text-4xl font-bold text-purple-900 mb-2 text-center tracking-wide 
               drop-shadow-md relative block mx-auto pb-3"
        style="letter-spacing: 0.05em;"
        >
        <span class="px-4 py-1" style="border-color: #6b21a8;">
            THE FHR ARCHIVE
        </span>
        </h1>

        <div class="flex justify-center mt-2 mb-6">
            <div class="h-1 w-24 bg-purple-900 rounded-full opacity-70"></div>
        </div>

        <p class="text-purple-700 text-center mb-2" id="quoteCount">
            Loading Archives...
        </p>
        <p class="text-purple-600 text-center mb-8 text-sm italic" id="subStatus">
            Fetching scrolls from the library...
        </p>

        <div id="quoteOfDayBox"
             class="bg-gradient-to-r from-pink-100 to-purple-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-pink-300 shadow-lg hidden">

            <h2 class="text-xl font-bold text-purple-900 mb-3">
                Featured Episode
            </h2>

            <p class="text-xl text-purple-900 mb-2 italic font-serif" id="quoteOfDayText"></p>
            <div class="flex justify-between items-end">
                <p class="text-sm text-purple-700" id="quoteOfDayInfo"></p>
                <a id="qodLink" href="#" class="text-xs bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-800 transition">Read Review</a>
            </div>
        </div>

        <div class="parchment rounded-lg p-6 mb-6 shadow-lg">
            <div class="relative mb-4">
                <svg class="absolute left-3 top-3 text-purple-400" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search titles (e.g. 'Sisterly Love')..."
                    class="w-full pl-10 pr-4 py-3 bg-purple-50 border border-purple-200 rounded-lg text-purple-900 placeholder-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
            </div>

            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Filter by Season:</p>
                <div class="flex flex-wrap gap-2" id="popularTerms"></div>
            </div>

            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Filter by Year:</p>
                <div class="flex flex-wrap gap-2" id="yearFilters"></div>
            </div>

            <button
                id="randomBtn"
                class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-400 to-purple-500 hover:from-purple-500 hover:to-purple-600 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-105 shadow-md"
            >
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                </svg>
                Random Episode
            </button>
        </div>

        <div id="randomQuoteDisplay" class="hidden bg-gradient-to-r from-purple-100 to-pink-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-purple-300 shadow-lg">
            <p class="text-xl text-purple-900 mb-2 italic font-serif" id="randomQuoteText"></p>
            <div class="flex justify-between items-end">
                <p class="text-sm text-purple-700" id="randomQuoteInfo"></p>
                <a id="randomLink" href="#" class="text-xs bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-800 transition">Read Review</a>
            </div>
        </div>

        <div class="parchment rounded-lg p-6 shadow-lg">
            <p class="text-purple-900 mb-4 font-semibold" id="resultCount"></p>
            <div class="space-y-4 max-h-[600px] overflow-y-auto" id="quotesList"></div>
            <div id="paginationContainer"></div>
        </div>
    </div>

<script>
// 1) Load the file list, then fetch every HTML file
async function loadFhrArchive() {
    try {
        // Fetch the list of filenames
        const response = await fetch('fhr/filelist.txt');
        
        if (!response.ok) {
            throw new Error("Could not find fhr/filelist.txt. Please create this file listing all HTML files.");
        }

        const listText = await response.text();
        const files = listText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

        document.getElementById('subStatus').textContent = `Found ${files.length} scrolls. Deciphering...`;

        // Parse files in parallel to build the index
        const parsedData = await Promise.all(files.map(async (filename, index) => {
            try {
                const fileResp = await fetch(`fhr/${filename}`);
                const htmlText = await fileResp.text();
                
                // Parse HTML string into a document just to get Title/Date
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');

                const title = doc.querySelector('h1')?.textContent.trim() || doc.querySelector('title')?.textContent.trim() || "Unknown Title";
                
                // Extract Date
                const dateEl = Array.from(doc.querySelectorAll('em')).find(el => el.textContent.includes('Original Date'));
                let dateStr = "";
                let rawDate = "";

                if (dateEl) {
                    const match = dateEl.textContent.match(/(\d{4}-\d{2}-\d{2})/);
                    if (match) {
                        rawDate = match[1]; 
                        dateStr = rawDate.replace(/-/g, ''); 
                    }
                }

                // Extract Season
                let season = "Specials";
                const seasonMatch = title.match(/Season\s*(\d+)/i);
                if (seasonMatch) {
                    season = "Season " + seasonMatch[1];
                }

                return {
                    id: index + 1,
                    text: title,   // For the list view, we still show Title
                    game: season,  
                    date: dateStr, 
                    displayDate: rawDate,
                    filename: filename
                };

            } catch (err) {
                console.warn(`Failed to parse ${filename}`, err);
                return null;
            }
        }));

        window.quotes = parsedData.filter(q => q !== null);
        console.log(`Loaded ${window.quotes.length} episodes`);
        initApp(); 
    } 
    catch (error) {
        document.getElementById('quoteCount').textContent = "Error Loading Archive";
        document.getElementById('subStatus').textContent = error.message;
        console.error(error);
    }
}

loadFhrArchive();

// 2) Main Application Logic
function initApp() {
    const quotes = window.quotes;
    
    document.getElementById('quoteCount').textContent = `Search through ${quotes.length} reviews`;
    document.getElementById('subStatus').textContent = "";

    // Helper: Format Date
    function formatDate(yyyymmdd) {
        if (!yyyymmdd || yyyymmdd.length !== 8) return yyyymmdd;
        const y = yyyymmdd.substring(0,4);
        const m = parseInt(yyyymmdd.substring(4,6)) - 1;
        const d = yyyymmdd.substring(6,8);
        const dateObj = new Date(y, m, d);
        return dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    let currentSearch = '';
    let selectedYear = null;
    let selectedSeason = null;
    let currentPage = 1;
    const itemsPerPage = 50;

    // --- FILTERS SETUP (Same as before) ---
    const seasons = [...new Set(quotes.map(q => q.game))].sort();
    const seasonContainer = document.getElementById('popularTerms');
    
    const allSeasonsBtn = document.createElement('button');
    allSeasonsBtn.textContent = 'All';
    allSeasonsBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
    allSeasonsBtn.onclick = () => { selectedSeason = null; updateSeasonButtons(); currentPage = 1; renderQuotes(); };
    seasonContainer.appendChild(allSeasonsBtn);

    seasons.forEach(s => {
        const btn = document.createElement('button');
        btn.textContent = s;
        btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
        btn.dataset.season = s;
        btn.onclick = () => { selectedSeason = s; updateSeasonButtons(); currentPage = 1; renderQuotes(); };
        seasonContainer.appendChild(btn);
    });

    function updateSeasonButtons() {
        Array.from(seasonContainer.children).forEach(btn => {
            btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
            if ((selectedSeason === null && btn.textContent === 'All') || (btn.dataset.season === selectedSeason)) {
                btn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors shadow-md';
            }
        });
    }

    const years = [...new Set(quotes.map(q => q.date.substring(0,4)))].sort().reverse();
    const yearContainer = document.getElementById('yearFilters');
    
    const allYearsBtn = document.createElement('button');
    allYearsBtn.textContent = 'All';
    allYearsBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
    allYearsBtn.onclick = () => { selectedYear = null; updateYearButtons(); currentPage = 1; renderQuotes(); };
    yearContainer.appendChild(allYearsBtn);

    years.forEach(year => {
        if(!year) return;
        const btn = document.createElement('button');
        btn.textContent = year;
        btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
        btn.dataset.year = year;
        btn.onclick = () => { selectedYear = year; updateYearButtons(); currentPage = 1; renderQuotes(); };
        yearContainer.appendChild(btn);
    });

    function updateYearButtons() {
        Array.from(yearContainer.children).forEach(btn => {
            btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
            if ((selectedYear === null && btn.textContent === 'All') || (btn.dataset.year === selectedYear)) {
                btn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors shadow-md';
            }
        });
    }

    // --- RENDER LOGIC ---
    function filterQuotes() {
        let out = quotes;
        if (selectedYear) out = out.filter(q => q.date.startsWith(selectedYear));
        if (selectedSeason) out = out.filter(q => q.game === selectedSeason);
        if (currentSearch) {
            const s = currentSearch.toLowerCase();
            out = out.filter(q => q.text.toLowerCase().includes(s) || q.date.includes(s));
        }
        return out;
    }

    function renderQuotes() {
        const filtered = filterQuotes();
        const list = document.getElementById('quotesList');
        const resultCount = document.getElementById('resultCount');

        resultCount.textContent = `${filtered.length} result${filtered.length !== 1 ? 's' : ''}`;
        list.innerHTML = '';

        const totalPages = Math.ceil(filtered.length / itemsPerPage);
        const startIdx = (currentPage - 1) * itemsPerPage;
        const endIdx = startIdx + itemsPerPage;
        const display = filtered.slice(startIdx, endIdx);

        if (!display.length) {
            list.innerHTML = '<p class="text-center text-purple-600">No episodes found matching that search.</p>';
            return;
        }

        display.forEach(q => {
            const div = document.createElement('div');
            div.className = 'bg-purple-50 hover:bg-purple-100 p-4 rounded-lg border border-purple-200 transition-colors flex justify-between items-center';
            
            div.innerHTML = `
                <div>
                    <a href="fhr/${q.filename}" class="text-purple-900 mb-1 font-bold block hover:underline text-lg">
                        ${q.text}
                    </a>
                    <p class="text-sm text-purple-700">${q.game} • ${formatDate(q.date)}</p>
                </div>
                <a href="fhr/${q.filename}" 
                   class="ml-4 px-4 py-2 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-lg text-sm transition-colors whitespace-nowrap">
                   Read Review
                </a>
            `;
            list.appendChild(div);
        });

        // Pagination setup (same as before)
        const pContainer = document.getElementById('paginationContainer');
        pContainer.innerHTML = '';
        if (totalPages > 1) {
            const paginationDiv = document.createElement('div');
            paginationDiv.className = 'flex justify-center items-center gap-3 mt-6';
            
            const prevBtn = document.createElement('button');
            prevBtn.textContent = '← Previous';
            prevBtn.className = `px-4 py-2 rounded-lg transition-colors ${currentPage === 1 ? 'bg-purple-200 text-purple-400 cursor-not-allowed' : 'bg-purple-400 hover:bg-purple-500 text-white'}`;
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => { if (currentPage > 1) { currentPage--; renderQuotes(); document.getElementById('quotesList').scrollIntoView({behavior:'smooth'}); }};
            
            const pageInfo = document.createElement('span');
            pageInfo.className = 'text-purple-900 font-semibold';
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next →';
            nextBtn.className = `px-4 py-2 rounded-lg transition-colors ${currentPage === totalPages ? 'bg-purple-200 text-purple-400 cursor-not-allowed' : 'bg-purple-400 hover:bg-purple-500 text-white'}`;
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => { if (currentPage < totalPages) { currentPage++; renderQuotes(); document.getElementById('quotesList').scrollIntoView({behavior:'smooth'}); }};
            
            paginationDiv.appendChild(prevBtn);
            paginationDiv.appendChild(pageInfo);
            paginationDiv.appendChild(nextBtn);
            pContainer.appendChild(paginationDiv);
        }
    }

    // --- EVENTS ---
    document.getElementById('searchInput').addEventListener('input', e => {
        currentSearch = e.target.value;
        currentPage = 1;
        renderQuotes();
    });

    // *** UPDATED RANDOM LOGIC ***
    document.getElementById('randomBtn').addEventListener('click', async () => {
        const displayBox = document.getElementById('randomQuoteDisplay');
        const textBox = document.getElementById('randomQuoteText');
        const infoBox = document.getElementById('randomQuoteInfo');
        const linkBox = document.getElementById('randomLink');

        // Show loading state
        displayBox.classList.remove('hidden');
        textBox.textContent = "Summoning a random moment from the archives...";
        textBox.style.fontStyle = "italic";
        infoBox.textContent = "";
        
        try {
            // 1. Pick a random episode object
            const r = quotes[Math.floor(Math.random() * quotes.length)];
            
            // 2. Fetch the HTML content
            const response = await fetch(`fhr/${r.filename}`);
            if(!response.ok) throw new Error("Failed to fetch episode");
            const htmlText = await response.text();

            // 3. Parse and find <p> tags
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, 'text/html');
            
            // 4. Filter logic:
            // - Must have text
            // - Must NOT be the "Original Date" line
            // - Must NOT be an image-only paragraph
            const paragraphs = Array.from(doc.querySelectorAll('p')).filter(p => {
                const text = p.textContent.trim();
                if (!text) return false; 
                if (text.includes('Original Date:')) return false;
                if (text.toLowerCase().includes('source:')) return false; // often blog junk
                return true;
            });

            if (paragraphs.length === 0) {
                textBox.textContent = "No readable text found in this review.";
                return;
            }

            // 5. Pick random paragraph
            const randomP = paragraphs[Math.floor(Math.random() * paragraphs.length)];

            // 6. Update UI
            textBox.textContent = `"${randomP.textContent.trim()}"`;
            // Change font size for long text
            textBox.className = randomP.textContent.length > 200 
                ? "text-lg text-purple-900 mb-2 font-serif" 
                : "text-xl text-purple-900 mb-2 italic font-serif";
            
            infoBox.textContent = `${r.text} • ${r.game}`;
            linkBox.href = `fhr/${r.filename}`;

        } catch (e) {
            console.error(e);
            textBox.textContent = "The archives are silent (Error loading quote).";
        }
    });

    // --- FEATURED EPISODE (Logic unchanged) ---
    const seed = new Date().getFullYear() * 1000 + (Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000));
    const qod = quotes[seed % quotes.length];
    
    if (qod) {
        document.getElementById('quoteOfDayBox').classList.remove('hidden');
        document.getElementById('quoteOfDayText').textContent = qod.text;
        document.getElementById('quoteOfDayInfo').textContent = `${qod.game} • ${formatDate(qod.date)}`;
        document.getElementById('qodLink').href = `fhr/${qod.filename}`;
    }

    renderQuotes();
}
</script>
</body>
</html>
