<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full House Reviewed Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(139, 92, 246, 0.25) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(167, 139, 250, 0.22) 0%, transparent 50%),
                linear-gradient(180deg, 
                  rgba(61, 41, 82, 0.85) 0%,
                  rgba(74, 53, 102, 0.85) 15%,
                  rgba(90, 68, 120, 0.85) 35%,
                  rgba(107, 83, 137, 0.85) 55%,
                  rgba(124, 98, 154, 0.85) 75%,
                  rgba(139, 113, 171, 0.85) 100%);
            background-attachment: fixed;
            min-height: 100vh;
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
        }
        .parchment {
            background: 
                repeating-linear-gradient(
                    0deg,
                    rgba(245, 237, 220, 0.03) 0px,
                    transparent 1px,
                    transparent 2px,
                    rgba(245, 237, 220, 0.03) 3px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(230, 220, 200, 0.02) 0px,
                    transparent 1px,
                    transparent 2px,
                    rgba(230, 220, 200, 0.02) 3px
                ),
                linear-gradient(
                    135deg,
                    rgba(250, 245, 235, 0.9) 0%,
                    rgba(245, 238, 225, 0.92) 50%,
                    rgba(248, 242, 230, 0.88) 100%
                );
            box-shadow: 
                0 16px 40px rgba(61, 27, 82, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                inset 0 0 100px rgba(139, 92, 246, 0.03);
        }
        h1, .text-purple-900, .text-purple-700, .text-purple-600 {
            color: #2d2240 !important;
        }
        
        a.text-purple-600 {
            color: #6b4f9a !important;
        }
        
        a.text-purple-600:hover {
            color: #3b2a62 !important;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto" style="max-width: 700px; padding: 60px 24px;">
        <h1 
        class="text-4xl font-bold text-purple-900 mb-2 text-center tracking-wide 
               drop-shadow-md relative block mx-auto pb-3"
        style="letter-spacing: 0.05em;"
        >
        <span class="px-4 py-1" style="border-color: #6b21a8;">
            THE FHR ARCHIVE
        </span>
        </h1>

        <div class="flex justify-center mt-2 mb-6">
            <div class="h-1 w-24 bg-purple-900 rounded-full opacity-70"></div>
        </div>

        <p class="text-purple-700 text-center mb-2" id="quoteCount">
            Loading Archives...
        </p>
        <p class="text-purple-600 text-center mb-8 text-sm italic" id="subStatus">
            Fetching scrolls from the library...
        </p>

        <div id="quoteOfDayBox"
             class="bg-gradient-to-r from-pink-100 to-purple-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-pink-300 shadow-lg hidden">

            <h2 class="text-xl font-bold text-purple-900 mb-3">
                Featured Episode
            </h2>

            <p class="text-xl text-purple-900 mb-2 italic font-serif" id="quoteOfDayText"></p>
            <div class="flex justify-between items-end">
                <p class="text-sm text-purple-700" id="quoteOfDayInfo"></p>
                <a id="qodLink" href="#" class="text-xs bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-800 transition">Read Review</a>
            </div>
        </div>

        <div class="parchment rounded-lg p-6 mb-6 shadow-lg">
            <div class="relative mb-4">
                <svg class="absolute left-3 top-3 text-purple-400" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search titles (e.g. 'Sisterly Love')..."
                    class="w-full pl-10 pr-4 py-3 bg-purple-50 border border-purple-200 rounded-lg text-purple-900 placeholder-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
            </div>

            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Filter by Season:</p>
                <div class="flex flex-wrap gap-2" id="popularTerms"></div>
            </div>

            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Filter by Year:</p>
                <div class="flex flex-wrap gap-2" id="yearFilters"></div>
            </div>

            <button
                id="randomBtn"
                class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-400 to-purple-500 hover:from-purple-500 hover:to-purple-600 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-105 shadow-md"
            >
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                </svg>
                Random Episode
            </button>
        </div>

        <div id="randomQuoteDisplay" class="hidden bg-gradient-to-r from-purple-100 to-pink-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-purple-300 shadow-lg">
            <p class="text-xl text-purple-900 mb-2 italic font-serif" id="randomQuoteText"></p>
            <div class="flex justify-between items-end">
                <p class="text-sm text-purple-700" id="randomQuoteInfo"></p>
                <a id="randomLink" href="#" class="text-xs bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-800 transition">Read Review</a>
            </div>
        </div>

        <div class="parchment rounded-lg p-6 shadow-lg">
            <p class="text-purple-900 mb-4 font-semibold" id="resultCount"></p>
            <div class="space-y-4 max-h-[600px] overflow-y-auto" id="quotesList"></div>
            <div id="paginationContainer"></div>
        </div>
    </div>

<script>
// 1) Load the file list, then fetch every HTML file
async function loadFhrArchive() {
    try {
        // Fetch the list of filenames
        const response = await fetch('fhr/filelist.txt');
        
        if (!response.ok) {
            throw new Error("Could not find fhr/filelist.txt. Please create this file listing all HTML files.");
        }

        const listText = await response.text();
        const files = listText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

        document.getElementById('subStatus').textContent = `Found ${files.length} scrolls. Deciphering...`;

        // Parse files in parallel
        const parsedData = await Promise.all(files.map(async (filename, index) => {
            try {
                const fileResp = await fetch(`fhr/${filename}`);
                const htmlText = await fileResp.text();
                
                // Parse HTML string into a document
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');

                // Extract Details based on your template
                const title = doc.querySelector('h1')?.textContent.trim() || doc.querySelector('title')?.textContent.trim() || "Unknown Title";
                
                // Extract Date: "Original Date: 2010-06-05"
                const dateEl = Array.from(doc.querySelectorAll('em')).find(el => el.textContent.includes('Original Date'));
                let dateStr = "";
                let rawDate = "";

                if (dateEl) {
                    const match = dateEl.textContent.match(/(\d{4}-\d{2}-\d{2})/);
                    if (match) {
                        rawDate = match[1]; // 2010-06-05
                        dateStr = rawDate.replace(/-/g, ''); // 20100605
                    }
                }

                // Extract "Season" for the tag category
                // Assuming title format: "Season 1, Episode 13..."
                let season = "Specials";
                const seasonMatch = title.match(/Season\s*(\d+)/i);
                if (seasonMatch) {
                    season = "Season " + seasonMatch[1];
                }

                return {
                    id: index + 1,
                    text: title,   // The "Quote" is the Title
                    game: season,  // The "Game" is the Season
                    date: dateStr, // YYYYMMDD
                    displayDate: rawDate,
                    filename: filename
                };

            } catch (err) {
                console.warn(`Failed to parse ${filename}`, err);
                return null;
            }
        }));

        // Filter out any failed loads
        window.quotes = parsedData.filter(q => q !== null);

        console.log(`Loaded ${window.quotes.length} episodes`);
        initApp(); // Start the app
    } 
    catch (error) {
        document.getElementById('quoteCount').textContent = "Error Loading Archive";
        document.getElementById('subStatus').textContent = error.message;
        console.error(error);
    }
}

loadFhrArchive();

// 2) Main Application Logic
function initApp() {
    const quotes = window.quotes;
    
    document.getElementById('quoteCount').textContent = `Search through ${quotes.length} reviews`;
    document.getElementById('subStatus').textContent = "";

    // -------------------------------
    // HELPERS
    // -------------------------------
    function formatDate(yyyymmdd) {
        if (!yyyymmdd || yyyymmdd.length !== 8) return yyyymmdd;
        const y = yyyymmdd.substring(0,4);
        const m = parseInt(yyyymmdd.substring(4,6)) - 1;
        const d = yyyymmdd.substring(6,8);
        const dateObj = new Date(y, m, d);
        return dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    let currentSearch = '';
    let selectedYear = null;
    let selectedSeason = null; // New filter
    let currentPage = 1;
    const itemsPerPage = 50;

    // -------------------------------
    // FILTERS GENERATION
    // -------------------------------
    
    // 1. Seasons (Game equivalent)
    const seasons = [...new Set(quotes.map(q => q.game))].sort();
    const seasonContainer = document.getElementById('popularTerms');
    
    // Add "All" button for seasons
    const allSeasonsBtn = document.createElement('button');
    allSeasonsBtn.textContent = 'All';
    allSeasonsBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
    allSeasonsBtn.onclick = () => {
        selectedSeason = null;
        updateSeasonButtons();
        currentPage = 1;
        renderQuotes();
    };
    seasonContainer.appendChild(allSeasonsBtn);

    seasons.forEach(s => {
        const btn = document.createElement('button');
        btn.textContent = s;
        btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
        btn.dataset.season = s;
        btn.onclick = () => {
            selectedSeason = s;
            updateSeasonButtons();
            currentPage = 1;
            renderQuotes();
        };
        seasonContainer.appendChild(btn);
    });

    function updateSeasonButtons() {
        const btns = Array.from(seasonContainer.children);
        btns.forEach(btn => {
            // Reset all
            btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
            // Highlight selected
            if (selectedSeason === null && btn.textContent === 'All') {
                btn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors shadow-md';
            }
            if (btn.dataset.season === selectedSeason) {
                btn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors shadow-md';
            }
        });
    }


    // 2. Years
    const years = [...new Set(quotes.map(q => q.date.substring(0,4)))].sort().reverse();
    const yearContainer = document.getElementById('yearFilters');
    
    // All Years Button
    const allYearsBtn = document.createElement('button');
    allYearsBtn.textContent = 'All';
    allYearsBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
    allYearsBtn.onclick = () => {
        selectedYear = null;
        updateYearButtons();
        currentPage = 1;
        renderQuotes();
    };
    yearContainer.appendChild(allYearsBtn);

    years.forEach(year => {
        if(!year) return;
        const btn = document.createElement('button');
        btn.textContent = year;
        btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
        btn.dataset.year = year;
        btn.onclick = () => {
            selectedYear = year;
            updateYearButtons();
            currentPage = 1;
            renderQuotes();
        };
        yearContainer.appendChild(btn);
    });

    function updateYearButtons() {
        const btns = Array.from(yearContainer.children);
        btns.forEach(btn => {
            btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
            if (selectedYear === null && btn.textContent === 'All') {
                btn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors shadow-md';
            }
            if (btn.dataset.year === selectedYear) {
                btn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors shadow-md';
            }
        });
    }

    // -------------------------------
    // FILTER LOGIC
    // -------------------------------
    function filterQuotes() {
        let out = quotes;

        if (selectedYear) {
            out = out.filter(q => q.date.startsWith(selectedYear));
        }
        if (selectedSeason) {
            out = out.filter(q => q.game === selectedSeason);
        }
        if (currentSearch) {
            const s = currentSearch.toLowerCase();
            out = out.filter(q => 
                q.text.toLowerCase().includes(s) || 
                q.date.includes(s)
            );
        }
        return out;
    }

    // -------------------------------
    // RENDER LOGIC
    // -------------------------------
    function renderQuotes() {
        const filtered = filterQuotes();
        const list = document.getElementById('quotesList');
        const resultCount = document.getElementById('resultCount');

        resultCount.textContent = `${filtered.length} result${filtered.length !== 1 ? 's' : ''}`;
        list.innerHTML = '';

        const totalPages = Math.ceil(filtered.length / itemsPerPage);
        const startIdx = (currentPage - 1) * itemsPerPage;
        const endIdx = startIdx + itemsPerPage;
        const display = filtered.slice(startIdx, endIdx);

        if (!display.length) {
            list.innerHTML = '<p class="text-center text-purple-600">No episodes found matching that search.</p>';
            return;
        }

        display.forEach(q => {
            const div = document.createElement('div');
            div.className = 'bg-purple-50 hover:bg-purple-100 p-4 rounded-lg border border-purple-200 transition-colors flex justify-between items-center';
            
            const formattedDate = formatDate(q.date);
            
            div.innerHTML = `
                <div>
                    <a href="fhr/${q.filename}" class="text-purple-900 mb-1 font-bold block hover:underline text-lg">
                        ${q.text}
                    </a>
                    <p class="text-sm text-purple-700">${q.game} • ${formattedDate}</p>
                </div>
                <a href="fhr/${q.filename}" 
                   class="ml-4 px-4 py-2 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-lg text-sm transition-colors whitespace-nowrap">
                   Read Review
                </a>
            `;
            list.appendChild(div);
        });

        // Pagination
        const pContainer = document.getElementById('paginationContainer');
        pContainer.innerHTML = '';
        if (totalPages > 1) {
            const paginationDiv = document.createElement('div');
            paginationDiv.className = 'flex justify-center items-center gap-3 mt-6';
            
            const prevBtn = document.createElement('button');
            prevBtn.textContent = '← Previous';
            prevBtn.className = `px-4 py-2 rounded-lg transition-colors ${currentPage === 1 ? 'bg-purple-200 text-purple-400 cursor-not-allowed' : 'bg-purple-400 hover:bg-purple-500 text-white'}`;
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => { if (currentPage > 1) { currentPage--; renderQuotes(); document.getElementById('quotesList').scrollIntoView({behavior:'smooth'}); }};
            
            const pageInfo = document.createElement('span');
            pageInfo.className = 'text-purple-900 font-semibold';
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next →';
            nextBtn.className = `px-4 py-2 rounded-lg transition-colors ${currentPage === totalPages ? 'bg-purple-200 text-purple-400 cursor-not-allowed' : 'bg-purple-400 hover:bg-purple-500 text-white'}`;
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => { if (currentPage < totalPages) { currentPage++; renderQuotes(); document.getElementById('quotesList').scrollIntoView({behavior:'smooth'}); }};
            
            paginationDiv.appendChild(prevBtn);
            paginationDiv.appendChild(pageInfo);
            paginationDiv.appendChild(nextBtn);
            pContainer.appendChild(paginationDiv);
        }
    }

    // -------------------------------
    // EVENTS
    // -------------------------------
    document.getElementById('searchInput').addEventListener('input', e => {
        currentSearch = e.target.value;
        currentPage = 1;
        renderQuotes();
    });

    document.getElementById('randomBtn').addEventListener('click', () => {
        const r = quotes[Math.floor(Math.random() * quotes.length)];
        const disp = document.getElementById('randomQuoteDisplay');
        document.getElementById('randomQuoteText').textContent = r.text;
        document.getElementById('randomQuoteInfo').textContent = `${r.game} • ${formatDate(r.date)}`;
        document.getElementById('randomLink').href = `fhr/${r.filename}`;
        disp.classList.remove('hidden');
    });

    // -------------------------------
    // FEATURED EPISODE
    // -------------------------------
    const now = new Date();
    const seed = now.getFullYear() * 1000 + (Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 86400000));
    const qod = quotes[seed % quotes.length];
    
    if (qod) {
        document.getElementById('quoteOfDayBox').classList.remove('hidden');
        document.getElementById('quoteOfDayText').textContent = qod.text;
        document.getElementById('quoteOfDayInfo').textContent = `${qod.game} • ${formatDate(qod.date)}`;
        document.getElementById('qodLink').href = `fhr/${qod.filename}`;
    }

    renderQuotes();
}
</script>
</body>
</html>
