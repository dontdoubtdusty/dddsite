<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Book of Carp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
		body {
		    background: 
		        radial-gradient(ellipse at 20% 30%, rgba(139, 92, 246, 0.25) 0%, transparent 50%),
		        radial-gradient(ellipse at 80% 70%, rgba(167, 139, 250, 0.22) 0%, transparent 50%),
		        linear-gradient(180deg, 
		          rgba(61, 41, 82, 0.85) 0%,
		          rgba(74, 53, 102, 0.85) 15%,
		          rgba(90, 68, 120, 0.85) 35%,
		          rgba(107, 83, 137, 0.85) 55%,
		          rgba(124, 98, 154, 0.85) 75%,
		          rgba(139, 113, 171, 0.85) 100%);
		    background-attachment: fixed;
		    min-height: 100vh;
		    font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
		}
		.parchment {
		    background: 
		        repeating-linear-gradient(
		            0deg,
		            rgba(245, 237, 220, 0.03) 0px,
		            transparent 1px,
		            transparent 2px,
		            rgba(245, 237, 220, 0.03) 3px
		        ),
		        repeating-linear-gradient(
		            90deg,
		            rgba(230, 220, 200, 0.02) 0px,
		            transparent 1px,
		            transparent 2px,
		            rgba(230, 220, 200, 0.02) 3px
		        ),
		        linear-gradient(
		            135deg,
		            rgba(250, 245, 235, 0.9) 0%,
		            rgba(245, 238, 225, 0.92) 50%,
		            rgba(248, 242, 230, 0.88) 100%
		        );
		    box-shadow: 
		        0 16px 40px rgba(61, 27, 82, 0.2),
		        inset 0 1px 0 rgba(255, 255, 255, 0.6),
		        inset 0 0 100px rgba(139, 92, 246, 0.03);
		}
		h1, .text-purple-900, .text-purple-700, .text-purple-600 {
		    color: #2d2240 !important;
		}
		
		a.text-purple-600 {
		    color: #6b4f9a !important;
		}
		
		a.text-purple-600:hover {
		    color: #3b2a62 !important;
		}
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto" style="max-width: 700px; padding: 60px 24px;">
	<h1 
    class="text-4xl font-bold text-purple-900 mb-2 text-center tracking-wide 
           drop-shadow-md relative block mx-auto pb-3"
    style="letter-spacing: 0.05em;"
	>
    <span class="px-4 py-1"
          style="border-color: #6b21a8;"
    >
        THE BOOK OF CARP
    </span>
	</h1>

	<div class="flex justify-center mt-2 mb-6">
    <div class="h-1 w-24 bg-purple-900 rounded-full opacity-70"></div>
	</div>


        <p class="text-purple-700 text-center mb-2" id="quoteCount">
		    Search through quotes
		</p>
		<p class="text-purple-600 text-center mb-8 text-sm italic" id="lostCount">
		    
		</p>
		<p class="text-purple-600 text-center mb-8 text-sm">
		    <a href="thebookofcarp.html" class="hover:text-purple-900 underline">What is the Book of Carp?</a>
		</p>
				
		<!-- Quote of the Day -->
<div id="quoteOfDayBox"
     class="bg-gradient-to-r from-pink-100 to-purple-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-pink-300 shadow-lg">

    <h2 class="text-xl font-bold text-purple-900 mb-3">
        Quote of the Day
    </h2>

    <p class="text-2xl text-purple-900 mb-2 italic" id="quoteOfDayText"></p>
    <p class="text-sm text-purple-700" id="quoteOfDayInfo"></p>
</div>


		
		

        <!-- Search Bar -->
        <div class="parchment rounded-lg p-6 mb-6 shadow-lg">
            <div class="relative mb-4">
                <svg class="absolute left-3 top-3 text-purple-400" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search quotes, games, or dates..."
                    class="w-full pl-10 pr-4 py-3 bg-purple-50 border border-purple-200 rounded-lg text-purple-900 placeholder-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
            </div>

            <!-- Popular Terms -->
            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Games played:</p>
                <div class="flex flex-wrap gap-2" id="popularTerms"></div>
            </div>

            <!-- Year Filter -->
            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Filter by year:</p>
                <div class="flex flex-wrap gap-2" id="yearFilters"></div>
            </div>

            <!-- Random Quote Button -->
            <button
                id="randomBtn"
                class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-400 to-purple-500 hover:from-purple-500 hover:to-purple-600 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-105 shadow-md"
            >
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                </svg>
                Random Quote
            </button>
        </div>

        <!-- Random Quote Display -->
        <div id="randomQuoteDisplay" class="hidden bg-gradient-to-r from-purple-100 to-pink-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-purple-300 shadow-lg">
            <p class="text-xl text-purple-900 mb-2 italic" id="randomQuoteText"></p>
            <p class="text-sm text-purple-700" id="randomQuoteInfo"></p>
        </div>

        <!-- Results -->
		<div class="parchment rounded-lg p-6 shadow-lg">
		    <p class="text-purple-900 mb-4 font-semibold" id="resultCount"></p>
		    
		    <div class="space-y-4 max-h-[600px] overflow-y-auto" id="quotesList"></div>
		    
		    <div id="paginationContainer"></div>
		</div>
    </div>
	<!-- 1) Load the quotes file -->
<script>
async function loadQuotes() {
    try {
        const response = await fetch('thebookofcarp.txt');
        const text = await response.text();

        // Make this accessible to everything below
        window.quotesData = text.split('\n').filter(line => line.trim() !== '');

        console.log(`Loaded ${window.quotesData.length} quotes`);

        initQuotes(); // Start the app AFTER file is loaded
    } 
    catch (error) {
        console.error(`Error loading quotes file: ${error}`);
    }
}

loadQuotes();
</script>


<!-- 2) All other logic goes inside initQuotes() -->
<script>
function initQuotes() {

    // -------------------------------
    // PARSE QUOTES
    // -------------------------------
    const quotes = quotesData.map(line => {
        const match = line.match(/^(\d+):\s*"([^"]+)"\s*\[([^\]]+)\]\s*\[([^\]]+)\]/);
        if (match) {
            return {
                id: match[1],
                text: match[2],
                game: match[3],
                date: match[4]
            };
        }
        return null;
    }).filter(Boolean);

    window.quotes = quotes; // make global for QOTD

    document.getElementById('quoteCount').textContent = `Search through 1708 memorable moments`;
	document.getElementById('lostCount').textContent = `101 lost to the depths of time`;


    // -------------------------------
    // DATE FORMATTER
    // -------------------------------
    function formatDate(rawDate) {
        if (!rawDate) return '';

        let clean = rawDate.replace(/\D/g, '');
        let d, m, y;

        if (clean.length === 8) {
            d = parseInt(clean.slice(0, 2));
            m = parseInt(clean.slice(2, 4)) - 1;
            y = parseInt(clean.slice(4, 8));
        } else if (rawDate.includes('/')) {
            const p = rawDate.split('/');
            d = parseInt(p[0]);
            m = parseInt(p[1]) - 1;
            y = parseInt(p[2]);
        } else {
            return rawDate;
        }

        const months = [
            'January','February','March','April','May','June',
            'July','August','September','October','November','December'
        ];

        return `${d} ${months[m]} ${y}`;
    }


	// -------------------------------
    // GAMES PLAYED
    // -------------------------------
    const popularTerms = [
        'Age of Empires II: Definitive Edition',
        'Animal Crossing: New Horizons',
        'Apex Legends',
        'California Orange Tree Simulator',
        'Citadel: Forged with Fire',
        'Dead by Daylight',
        'Deceit',
        'Dragon Ball: The Breakers',
        'Dragon Ball: Xenoverse 2',
        'Dungeon of the Endless',
        'Evil Dead: The Game',
        'Extreme Maze Building Simulator',
        'F-Zero 99',
        'Fall Guys',
        'Fortnite',
        'Gartic',
        'Jackbox Party Packs',
        'Just Chatting',
        'League of Legends',
        'Little Nightmares',
        'Luigi\'s Mansion 3',
        'Mario Golf: Super Rush',
        'Minecraft',
        'My Hero Ultra Rumble',
        'Not the Robots',
        'Pokémon MMO 3D',
        'Pokémon Unite',
        'ROBLOX',
        'Rumbleverse',
        'Sea of Thieves',
        'Special Events',
        'Spellbreak',
        'Split or Steal',
        'Super Animal Royale',
        'Super Mama Maker 2',
        'Super Mario Maker 2',
        'Super Smash Bros. Ultimate',
        'Super Smash Bros. Ultimate on the Nintendo Switch',
        'Super Smash Brethren',
        'Super Spicy Bros',
        'Supreme Smash Brothers Omega',
        'Temtem',
        'The Council',
        'The Elder Scrolls Online',
        'The Jackbox Party Pack 2',
        'The Jackbox Party Pack 3',
        'The Jackbox Party Pack 4',
        'The Jackbox Party Pack 6',
        'Throne of Lies',
        'VRChat',
        'Wildermyth',
        'World of Warcraft',
        'Yu-Gi-Oh! Master Duel'
    ];

    let currentSearch = '';
	let selectedYear = null;
	let currentPage = 1;
	const itemsPerPage = 50;
	


    // -------------------------------
    // YEAR FILTERS
    // -------------------------------
    const currentYear = new Date().getFullYear();
    const years = [...new Set(quotes.map(q => {
        const m = q.date.match(/\d{4}/);
        if (m) {
            const y = parseInt(m[0]);
            if (y >= 2018 && y <= currentYear) return y.toString();
        }
        return null;
    }).filter(Boolean))].sort((a, b) => b - a);

    const yearFiltersContainer = document.getElementById('yearFilters');

    const allYearsBtn = document.createElement('button');
    allYearsBtn.textContent = 'All Years';
    allYearsBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
    allYearsBtn.onclick = () => {
	    selectedYear = null;
	    currentPage = 1;
	    updateYearButtons();
	    renderQuotes();
	};
    yearFiltersContainer.appendChild(allYearsBtn);

    years.forEach(year => {
        const btn = document.createElement('button');
        btn.textContent = year;
        btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
        btn.dataset.year = year;
        btn.onclick = () => {
		    selectedYear = year;
		    currentPage = 1;
		    updateYearButtons();
		    renderQuotes();
		};
        yearFiltersContainer.appendChild(btn);
    });

    function updateYearButtons() {
        const allBtn = yearFiltersContainer.firstChild;
        const yearBtns = [...yearFiltersContainer.children].slice(1);

        if (selectedYear === null) {
            allBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
            yearBtns.forEach(btn => btn.className =
                'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors'
            );
        } else {
            allBtn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
            yearBtns.forEach(btn => {
                btn.className = (btn.dataset.year === selectedYear)
                    ? 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors'
                    : 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
            });
        }
    }


    // -------------------------------
    // POPULAR TERM BUTTONS
    // -------------------------------
    const popularContainer = document.getElementById('popularTerms');

    popularTerms.forEach(term => {
        const btn = document.createElement('button');
        btn.textContent = term;
        btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 rounded-full text-sm text-purple-900 transition-colors';
        btn.onclick = () => {
            document.getElementById('searchInput').value = term;
            currentSearch = term;
            renderQuotes();
        };
        popularContainer.appendChild(btn);
    });


    // -------------------------------
    // QUOTE FILTERING
    // -------------------------------
    function filterQuotes() {
        let out = quotes;

        if (selectedYear !== null) {
            out = out.filter(q => q.date.includes(selectedYear));
        }

        if (currentSearch) {
            const s = currentSearch.toLowerCase();
            out = out.filter(q =>
                q.text.toLowerCase().includes(s) ||
                q.game.toLowerCase().includes(s) ||
                q.date.includes(s)
            );
        }
        return out;
    }


    // -------------------------------
    // RENDER LIST
    // -------------------------------
    function renderQuotes() {
        const filtered = filterQuotes();
        const list = document.getElementById('quotesList');
        const resultCount = document.getElementById('resultCount');

        resultCount.textContent = `${filtered.length} result${filtered.length !== 1 ? 's' : ''}`;
        list.innerHTML = '';

        const totalPages = Math.ceil(filtered.length / itemsPerPage);
		const startIdx = (currentPage - 1) * itemsPerPage;
		const endIdx = startIdx + itemsPerPage;
		const display = filtered.slice(startIdx, endIdx);

        if (!display.length) {
            list.innerHTML = '<p class="text-center text-purple-600">No quotes found. Try a different search term!</p>';
            return;
        }

        display.forEach((q, index) => {
		    // Check if there's a gap before this quote
		    if (index > 0) {
		        const prevId = parseInt(display[index - 1].id);
		        const currentId = parseInt(q.id);
		        const gap = currentId - prevId - 1;
		        
		        if (gap > 0) {
		            const gapDiv = document.createElement('div');
		            gapDiv.className = 'text-center py-3 my-2';
		            gapDiv.innerHTML = `
		                <p class="text-purple-400 italic text-sm">
		                    ✦ ${gap} moment${gap !== 1 ? 's' : ''} lost to the aether ✦
		                </p>
		            `;
		            list.appendChild(gapDiv);
		        }
		    }
		    
		    // Original quote display code
		    const div = document.createElement('div');
		    div.className = 'bg-purple-50 hover:bg-purple-100 p-4 rounded-lg border border-purple-200 transition-colors';
		
		    const safe = q.text.replace(/'/g, "\\'");
		    const formatted = formatDate(q.date);
		
		    div.innerHTML = `
		        <p class="text-purple-900 mb-2">
		            <span class="text-purple-600 font-semibold">#${q.id}:</span>
		            "${q.text}"
		        </p>
		        <p class="text-sm text-purple-700 mb-2">${q.game} • ${formatted}</p>
		
		        <button
		            class="px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-xs transition-colors"
		            onclick="copyQuote('${safe}')">
		            Copy Quote
		        </button>
		    `;
		    list.appendChild(div);
		});

        if (totalPages > 1) {
		    const paginationDiv = document.createElement('div');
		    paginationDiv.className = 'flex justify-center items-center gap-3 mt-6';
		    
		    // Previous button
		    const prevBtn = document.createElement('button');
		    prevBtn.textContent = '← Previous';
		    prevBtn.className = `px-4 py-2 rounded-lg transition-colors ${currentPage === 1 ? 'bg-purple-200 text-purple-400 cursor-not-allowed' : 'bg-purple-400 hover:bg-purple-500 text-white'}`;
		    prevBtn.disabled = currentPage === 1;
		    prevBtn.onclick = () => {
		        if (currentPage > 1) {
		            currentPage--;
		            renderQuotes();
		            document.getElementById('quotesList').scrollIntoView({ behavior: 'smooth' });
		        }
		    };
		    
		    // Page info
		    const pageInfo = document.createElement('span');
		    pageInfo.className = 'text-purple-900 font-semibold';
		    pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
		    
		    // Next button
		    const nextBtn = document.createElement('button');
		    nextBtn.textContent = 'Next →';
		    nextBtn.className = `px-4 py-2 rounded-lg transition-colors ${currentPage === totalPages ? 'bg-purple-200 text-purple-400 cursor-not-allowed' : 'bg-purple-400 hover:bg-purple-500 text-white'}`;
		    nextBtn.disabled = currentPage === totalPages;
		    nextBtn.onclick = () => {
		        if (currentPage < totalPages) {
		            currentPage++;
		            renderQuotes();
		            document.getElementById('quotesList').scrollIntoView({ behavior: 'smooth' });
		        }
		    };
		    
		    paginationDiv.appendChild(prevBtn);
		    paginationDiv.appendChild(pageInfo);
		    paginationDiv.appendChild(nextBtn);
		    document.getElementById('paginationContainer').innerHTML = '';
			document.getElementById('paginationContainer').appendChild(paginationDiv);
		}
    }


    // -------------------------------
    // SEARCH LISTENER
    // -------------------------------
    document.getElementById('searchInput').addEventListener('input', e => {
	    currentSearch = e.target.value;
	    currentPage = 1; // Reset to first page
	    renderQuotes();
	});


    // -------------------------------
    // RANDOM QUOTE
    // -------------------------------
    document.getElementById('randomBtn').addEventListener('click', () => {
        const r = quotes[Math.floor(Math.random() * quotes.length)];
        document.getElementById('randomQuoteText').textContent = `#${r.id}: "${r.text}"`;
        document.getElementById('randomQuoteInfo').textContent = `${r.game} • ${formatDate(r.date)}`;
        document.getElementById('randomQuoteDisplay').classList.remove('hidden');
    });


    // -------------------------------
    // QUOTE OF THE DAY
    // -------------------------------
    function getQuoteOfTheDay() {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 0);
        const diff = now - start;
        const oneDay = 86400000;
        const day = Math.floor(diff / oneDay);
        const seed = now.getFullYear() * 1000 + day;
        return quotes[seed % quotes.length];
    }

    const qod = getQuoteOfTheDay();
    document.getElementById('quoteOfDayText').textContent = `#${qod.id}: "${qod.text}"`;
    document.getElementById('quoteOfDayInfo').textContent = `${qod.game} • ${formatDate(qod.date)}`;


    // -------------------------------
    // CLIPBOARD
    // -------------------------------
    window.copyQuote = function(text) {
        navigator.clipboard.writeText(text);
    };


    // INITIAL RENDER
    renderQuotes();
}
</script>

</body>
</html>
