<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Book of Carp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>


        body {
            background: linear-gradient(to bottom right, #f3e8ff, #e9d5ff, #ddd6fe);
            min-height: 100vh;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto">
<h1 
    class="text-4xl font-bold text-purple-900 mb-2 text-center tracking-wide 
           drop-shadow-md relative block mx-auto pb-3"
    style="letter-spacing: 0.05em;"
>
    <span class="px-4 py-1"
          style="border-color: #6b21a8;"
    >
        The Book of Carp
    </span>
</h1>

<div class="flex justify-center mt-2 mb-6">
    <div class="h-1 w-24 bg-purple-900 rounded-full opacity-70"></div>
</div>


        <p class="text-purple-700 text-center mb-8" id="quoteCount">
            Search through quotes
        </p>
		
		<!-- Quote of the Day -->
<div id="quoteOfDayBox"
     class="bg-gradient-to-r from-pink-100 to-purple-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-pink-300 shadow-lg">

    <h2 class="text-xl font-bold text-purple-900 mb-3">
        Quote of the Day
    </h2>

    <p class="text-2xl text-purple-900 mb-2 italic" id="quoteOfDayText"></p>
    <p class="text-sm text-purple-700" id="quoteOfDayInfo"></p>
</div>


		
		

        <!-- Search Bar -->
        <div class="bg-white/80 backdrop-blur-lg rounded-lg p-6 mb-6 shadow-lg">
            <div class="relative mb-4">
                <svg class="absolute left-3 top-3 text-purple-400" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search quotes, games, or dates..."
                    class="w-full pl-10 pr-4 py-3 bg-purple-50 border border-purple-200 rounded-lg text-purple-900 placeholder-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
            </div>

            <!-- Popular Terms -->
            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Popular searches:</p>
                <div class="flex flex-wrap gap-2" id="popularTerms"></div>
            </div>

            <!-- Year Filter -->
            <div class="mb-4">
                <p class="text-sm text-purple-700 mb-2">Filter by year:</p>
                <div class="flex flex-wrap gap-2" id="yearFilters"></div>
            </div>

            <!-- Random Quote Button -->
            <button
                id="randomBtn"
                class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-400 to-purple-500 hover:from-purple-500 hover:to-purple-600 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-105 shadow-md"
            >
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                </svg>
                Random Quote
            </button>
        </div>

        <!-- Random Quote Display -->
        <div id="randomQuoteDisplay" class="hidden bg-gradient-to-r from-purple-100 to-pink-100 backdrop-blur-lg rounded-lg p-6 mb-6 border-2 border-purple-300 shadow-lg">
            <p class="text-xl text-purple-900 mb-2 italic" id="randomQuoteText"></p>
            <p class="text-sm text-purple-700" id="randomQuoteInfo"></p>
        </div>

        <!-- Results -->
        <div class="bg-white/80 backdrop-blur-lg rounded-lg p-6 shadow-lg">
            <p class="text-purple-900 mb-4 font-semibold" id="resultCount"></p>
            
            <div class="space-y-4 max-h-[600px] overflow-y-auto" id="quotesList"></div>
        </div>
    </div>
	<script>
	    async function loadQuotes() {
	        try {
	            const response = await fetch('thebookofcarp.txt'); 
	            const text = await response.text();
	
	            // Parse it however your page expects.
	            // If your entries are newline-separated, split them:
	            const quotesData = text.split('\n').filter(line => line.trim() !== '');
	
	            console.log(quotesData);
	            // Now you can use quotesData however your code did before.
	        }
	        catch (error) {
	            console.error("Error loading quotes file:", error);
	        }
	    }
	
	    loadQuotes();
	</script>

    <script>
		function formatDate(rawDate) {
        if (!rawDate) return '';

        let cleanDate = rawDate.replace(/\D/g, '');

        let day, month, year;

        if (cleanDate.length === 8) {
            // DDMMYYYY
            day = parseInt(cleanDate.slice(0, 2), 10);
            month = parseInt(cleanDate.slice(2, 4), 10) - 1;
            year = parseInt(cleanDate.slice(4, 8), 10);
        } else if (rawDate.includes('/')) {
            // DD/MM/YYYY
            const parts = rawDate.split('/');
            day = parseInt(parts[0], 10);
            month = parseInt(parts[1], 10) - 1;
            year = parseInt(parts[2], 10);
        } else {
            return rawDate; // fallback
        }

        const months = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        return `${day} ${months[month]} ${year}`;
    }

        const quotes = quotesData.split('\n').map(line => {
            const match = line.match(/^(\d+):\s*"([^"]+)"\s*\[([^\]]+)\]\s*\[([^\]]+)\]/);
            if (match) {
                return {
                    id: match[1],
                    text: match[2],
                    game: match[3],
                    date: match[4]
                };
            }
            return null;
        }).filter(Boolean);

        const popularTerms = [
            'poop', 'World of Warcraft', 'Dead by Daylight', 'Fortnite', 
            'Dragon Ball', 'Mario Kart', 'fuck', 'poopy', 'ass',
            'Super Smash Bros', 'Roblox', 'Elder Scrolls', 'corn'
        ];

        let currentSearch = '';
        let selectedYear = null;

        document.getElementById('quoteCount').textContent = `Search through ${quotes.length} memorable moments`;

        // Get unique years from quotes (only valid years that have already happened)
        const currentYear = new Date().getFullYear();
        const years = [...new Set(quotes.map(q => {
            const match = q.date.match(/\d{4}/);
            if (match) {
                const year = parseInt(match[0]);
                // Only include years between 1900 and current year
                if (year >= 2018 && year <= currentYear) {
                    return year.toString();
                }
            }
            return null;
        }).filter(Boolean))].sort((a, b) => b - a);

        // Populate year filters
        const yearFiltersContainer = document.getElementById('yearFilters');
        
        const allYearsBtn = document.createElement('button');
        allYearsBtn.textContent = 'All Years';
        allYearsBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
        allYearsBtn.onclick = () => {
            selectedYear = null;
            updateYearButtons();
            renderQuotes();
        };
        yearFiltersContainer.appendChild(allYearsBtn);

        years.forEach(year => {
            const btn = document.createElement('button');
            btn.textContent = year;
            btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
            btn.dataset.year = year;
            btn.onclick = () => {
                selectedYear = year;
                updateYearButtons();
                renderQuotes();
            };
            yearFiltersContainer.appendChild(btn);
        });

        function updateYearButtons() {
            const allBtn = yearFiltersContainer.firstChild;
            const yearBtns = Array.from(yearFiltersContainer.children).slice(1);
            
            if (selectedYear === null) {
                allBtn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
                yearBtns.forEach(btn => {
                    btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
                });
            } else {
                allBtn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
                yearBtns.forEach(btn => {
                    if (btn.dataset.year === selectedYear) {
                        btn.className = 'px-3 py-1 bg-purple-400 text-white rounded-full text-sm transition-colors';
                    } else {
                        btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-sm transition-colors';
                    }
                });
            }
        }

        // Populate popular terms
        const popularTermsContainer = document.getElementById('popularTerms');
        popularTerms.forEach(term => {
            const btn = document.createElement('button');
            btn.textContent = term;
            btn.className = 'px-3 py-1 bg-purple-200 hover:bg-purple-300 rounded-full text-sm text-purple-900 transition-colors';
            btn.onclick = () => {
                document.getElementById('searchInput').value = term;
                currentSearch = term;
                renderQuotes();
            };
            popularTermsContainer.appendChild(btn);
        });

        function filterQuotes() {
            let filtered = quotes;
            
            // Filter by year first
            if (selectedYear !== null) {
                filtered = filtered.filter(quote => quote.date.includes(selectedYear));
            }
            
            // Then filter by search term
            if (currentSearch) {
                const lowerSearch = currentSearch.toLowerCase();
                filtered = filtered.filter(quote => 
                    quote.text.toLowerCase().includes(lowerSearch) ||
                    quote.game.toLowerCase().includes(lowerSearch) ||
                    quote.date.includes(lowerSearch)
                );
            }
            
            return filtered;
        }

  function renderQuotes() {
        const filteredQuotes = filterQuotes();
        const quotesList = document.getElementById('quotesList');
        const resultCount = document.getElementById('resultCount');

        resultCount.textContent = `${filteredQuotes.length} result${filteredQuotes.length !== 1 ? 's' : ''}`;
        quotesList.innerHTML = '';

        const displayQuotes = filteredQuotes.slice(0, 50);

        if (displayQuotes.length === 0) {
            quotesList.innerHTML = '<p class="text-center text-purple-600">No quotes found. Try a different search term!</p>';
            return;
        }

        displayQuotes.forEach(quote => {
            const div = document.createElement('div');
            div.className = 'bg-purple-50 hover:bg-purple-100 p-4 rounded-lg border border-purple-200 transition-colors';

            const safeText = quote.text.replace(/'/g, "\\'");
            const formattedDate = formatDate(quote.date); // <-- Here we format the date

            div.innerHTML = `
                <p class="text-purple-900 mb-2">
                    <span class="text-purple-600 font-semibold">#${quote.id}:</span>
                    "${quote.text}"
                </p>
                <p class="text-sm text-purple-700 mb-2">${quote.game} • ${formattedDate}</p>

                <button
                    class="px-3 py-1 bg-purple-200 hover:bg-purple-300 text-purple-900 rounded-full text-xs transition-colors"
                    onclick="copyQuote('${safeText}')">
                    Copy Quote
                </button>
            `;

            quotesList.appendChild(div);
        });

    if (filteredQuotes.length > 50) {
        const msg = document.createElement('p');
        msg.className = 'text-center text-purple-600 text-sm';
        msg.textContent = 'Showing first 50 results. Refine your search to see more.';
        quotesList.appendChild(msg);
    }
}


        document.getElementById('searchInput').addEventListener('input', (e) => {
            currentSearch = e.target.value;
            renderQuotes();
        });

        document.getElementById('randomBtn').addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const randomQuote = quotes[randomIndex];
            
            document.getElementById('randomQuoteText').textContent = `#${randomQuote.id}: "${randomQuote.text}"`;
            document.getElementById('randomQuoteInfo').textContent = `${randomQuote.game} • ${formatDate(randomQuote.date)}`;
            document.getElementById('randomQuoteDisplay').classList.remove('hidden');
        });

        // Initial render
        renderQuotes();
    </script>
	<script>
function getQuoteOfTheDay() {
    const now = new Date();

    // Calculate the day-of-year number (1–365/366)
    const start = new Date(now.getFullYear(), 0, 0);
    const diff = now - start;
    const oneDay = 1000 * 60 * 60 * 24;
    const dayOfYear = Math.floor(diff / oneDay);

    // Combine current year + day into one unique number
    const seed = now.getFullYear() * 1000 + dayOfYear;

    // Pick quote using modulo so it works with ANY number of quotes
    const index = seed % quotes.length;

    return quotes[index];
}

// After quotes array is loaded:
const qod = getQuoteOfTheDay();
document.getElementById('quoteOfDayText').textContent = `#${qod.id}: "${qod.text}"`;
document.getElementById('quoteOfDayInfo').textContent = `${qod.game} • ${formatDate(qod.date)}`;



function copyQuote(text) {
    navigator.clipboard.writeText(text).then(() => {
    });
}

</script>
</body>
</html>
