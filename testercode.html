<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Cozy Village - Puns</title>
    <style>
        body {
            background-color: #f0f8ff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none; 
        }

        #game-world {
            width: 500px;
            height: 400px;
            background-color: #855E42;
            border: 10px solid #5C4033;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background-image: radial-gradient(#9e7052 20%, transparent 20%),
                              radial-gradient(#9e7052 20%, transparent 20%);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
        }

        .entity {
            width: 40px;
            height: 40px;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        #player {
            background-color: #ff6b6b;
            color: white;
            border-radius: 50%;
            border-bottom: 3px solid rgba(0,0,0,0.2); 
        }

        #neighbor {
            background-color: #4ecdc4;
            color: white;
            border-radius: 50%;
        }

        .furniture {
            width: 40px;
            height: 40px;
            background-color: #ffe66d;
            position: absolute;
            border-radius: 5px;
            border: 2px solid #d4c04d;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        .held {
            border-color: #ff6b6b;
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 9999 !important;
            opacity: 0.8;
        }

        #dialogue-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            background: white;
            border: 4px solid #4ecdc4;
            border-radius: 15px;
            padding: 15px;
            display: none;
            font-size: 14px;
            z-index: 10000;
        }
        
        #instructions {
            position: absolute;
            top: -40px;
            width: 100%;
            text-align: center;
            color: #555;
            font-size: 12px;
        }
        #lighting-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(8, 1fr);
        }
        
        .light-tile {
            background-color: rgba(0, 0, 0, 0.7);
            transition: background-color 0.3s;
        }
        
        .light-tile.lit {
            background-color: rgba(0, 0, 0, 0);
        }
    </style>
</head>
<body>

    <div id="game-world">
        <div id="lighting-overlay"></div>
        <div id="instructions">Arrows: Move ‚Ä¢ SPACE: Action</div>
        
        <div id="plant" class="furniture">ü™¥</div>
        <div id="fireplace" class="furniture">ü™µ</div>
        <div id="neighbor" class="entity">üêª</div>
        <div id="player" class="entity">üôÇ</div>

        <div id="dialogue-box">
            <strong style="color:#4ecdc4">Bear:</strong> <span id="dialogue-text">...</span>
        </div>
    </div>

    <script>
    const player = document.getElementById('player');
    const neighbor = document.getElementById('neighbor');
    const plant = document.getElementById('plant');
    const fireplace = document.getElementById('fireplace');
    const dialogueBox = document.getElementById('dialogue-box');
    const dialogueText = document.getElementById('dialogue-text');
    
    // --- GAME VARIABLES ---
    let playerObj = { x: 230, y: 300, w: 40, h: 40, el: player };
    let neighborObj = { x: 230, y: 50, w: 40, h: 40, el: neighbor };
    let plantObj = { x: 100, y: 200, w: 40, h: 40, el: plant, isHeld: false };
    let fireplaceObj = { x: 400, y: 100, w: 40, h: 40, el: fireplace, isLit: false };
    let colliders = [neighborObj, plantObj, fireplaceObj];
    const speed = 4;
    const keys = { ArrowUp:false, ArrowDown:false, ArrowLeft:false, ArrowRight:false };
    let facing = 'down'; 
    
    // --- LIGHTING SETUP ---
    const lightingOverlay = document.getElementById('lighting-overlay');
    const gridCols = 10;
    const gridRows = 8;
    const tiles = [];
    
    function initLightingGrid() {
        for (let i = 0; i < gridRows * gridCols; i++) {
            const tile = document.createElement('div');
            tile.className = 'light-tile';
            lightingOverlay.appendChild(tile);
            tiles.push(tile);
        }
    }
    
    function updateLighting() {
        const tileWidth = 500 / gridCols;
        const tileHeight = 400 / gridRows;
        
        tiles.forEach((tile, i) => {
            const col = i % gridCols;
            const row = Math.floor(i / gridCols);
            const tileCenterX = col * tileWidth + tileWidth / 2;
            const tileCenterY = row * tileHeight + tileHeight / 2;
            
            if (fireplaceObj.isLit) {
                const fireX = fireplaceObj.x + 20;
                const fireY = fireplaceObj.y + 20;
                
                // Cone shape: check if tile is above fireplace and within cone angle
                const dx = tileCenterX - fireX;
                const dy = tileCenterY - fireY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * (180 / Math.PI);
                
                // Upward cone: -90 degrees (straight up) with spread
                const isAbove = dy < 0;
                const isInCone = Math.abs(angle + 90) < 60; // 60 degree spread
                const isClose = distance < 200;
                
                if (isAbove && isInCone && isClose) {
                    tile.classList.add('lit');
                } else {
                    tile.classList.remove('lit');
                }
            } else {
                tile.classList.remove('lit');
            }
        });
    }
    
    // --- DIALOGUE SETUP (RUNS ONCE ON LOAD) ---
    let todaysMessage = "";
    
    function generateDailyMessage() {
        const date = new Date();
        const day = date.getDay(); // 0=Sun, 1=Mon, ..., 4=Thu
    
        // Specific Logic for Thursday (Day 4)
        if (day === 4) {
            const puns = [
                "I'm feeling paws-itively relaxed today.",
                "Have a bear-y good Thursday!",
                "My schedule is completely bear today.",
                "Un-bear-lievable weather we're having!",
                "Just grinning and bearing it until Friday."
            ];
            // Pick a random number between 0 and 4
            const randomIndex = Math.floor(Math.random() * puns.length);
            todaysMessage = puns[randomIndex];
        } else {
            // Fallback for other days
            const generic = ["Sunday Funday!", "Monday blues...", "Taco Tuesday!", "Hump Day!", "It's Thursday.", "Fri-yay!", "K.K. Saturday!"];
            todaysMessage = generic[day];
        }
    }
    
    // Run this immediately so the message is ready
    generateDailyMessage();
    
    
    // --- INPUT LISTENERS ---
    document.addEventListener('keydown', (e) => {
        if (keys.hasOwnProperty(e.key)) keys[e.key] = true;
        if (e.key === ' ' && !e.repeat) handleInteraction();
    });
    document.addEventListener('keyup', (e) => {
        if (keys.hasOwnProperty(e.key)) keys[e.key] = false;
    });
    
    // --- GAME LOOP ---
    function gameLoop() {
        let dx = 0; let dy = 0;
        if (keys.ArrowUp) { dy = -speed; facing = 'up'; }
        if (keys.ArrowDown) { dy = speed; facing = 'down'; }
        if (keys.ArrowLeft) { dx = -speed; facing = 'left'; }
        if (keys.ArrowRight) { dx = speed; facing = 'right'; }
    
        let nextX = playerObj.x + dx;
        let nextY = playerObj.y + dy;
    
        if (!checkCollision(nextX, playerObj.y)) playerObj.x = nextX;
        if (!checkCollision(playerObj.x, nextY)) playerObj.y = nextY;
    
        // Boundaries
        if (playerObj.x < 0) playerObj.x = 0;
        if (playerObj.y < 0) playerObj.y = 0;
        if (playerObj.x > 460) playerObj.x = 460;
        if (playerObj.y > 360) playerObj.y = 360;
    
        updateEntity(playerObj);
        updateEntity(neighborObj);
        updateEntity(plantObj);
        updateEntity(fireplaceObj);
    
        if (dx !== 0 || dy !== 0) dialogueBox.style.display = 'none';
        requestAnimationFrame(gameLoop);
    }
    
    // --- HELPERS ---
    function checkCollision(newX, newY) {
        let pRect = { x: newX, y: newY, w: playerObj.w, h: playerObj.h };
        for (let obj of colliders) {
            if (obj === plantObj && plantObj.isHeld) continue;
            if (isOverlapping(pRect, obj)) return true;
        }
        return false;
    }
    
    function isOverlapping(rect1, rect2) {
        return (rect1.x < rect2.x + rect2.w && rect1.x + rect1.w > rect2.x &&
                rect1.y < rect2.y + rect2.h && rect1.y + rect1.h > rect2.y);
    }
    
    function updateEntity(obj) {
        if (obj === plantObj && obj.isHeld) {
            obj.x = playerObj.x;
            obj.y = playerObj.y - 25; 
        }
        obj.el.style.left = obj.x + 'px';
        obj.el.style.top = obj.y + 'px';
        if (obj.isHeld) obj.el.style.zIndex = 1000;
        else obj.el.style.zIndex = Math.floor(obj.y);
    }
    
    function handleInteraction() {
        if (plantObj.isHeld) {
            dropItem();
        } else {
            let dPlant = getDistance(playerObj, plantObj);
            let dNeigh = getDistance(playerObj, neighborObj);
            let dFire = getDistance(playerObj, fireplaceObj);
    
            if (dPlant < 50) {
                plantObj.isHeld = true;
                plantObj.el.classList.add('held');
            } else if (dNeigh < 60) {
                // Just show the message we generated at the start
                dialogueText.innerText = todaysMessage;
                dialogueBox.style.display = 'block';
            } else if (dFire < 60) {
                fireplaceObj.isLit = !fireplaceObj.isLit;
                fireplaceObj.el.innerText = fireplaceObj.isLit ? 'üî•' : 'ü™µ';
                updateLighting();
            }
        }
    }
    
    function dropItem() {
        plantObj.isHeld = false;
        plantObj.el.classList.remove('held');
        let dropDist = 45; 
        if (facing === 'up')    plantObj.y = playerObj.y - dropDist;
        if (facing === 'down')  plantObj.y = playerObj.y + dropDist;
        if (facing === 'left')  plantObj.x = playerObj.x - dropDist;
        if (facing === 'right') plantObj.x = playerObj.x + dropDist;
        plantObj.x = Math.round(plantObj.x / 10) * 10;
        plantObj.y = Math.round(plantObj.y / 10) * 10;
        if (plantObj.x < 0) plantObj.x = 0;
        if (plantObj.y < 0) plantObj.y = 0;
        if (plantObj.x > 460) plantObj.x = 460;
        if (plantObj.y > 360) plantObj.y = 360;
    }
    
    function getDistance(o1, o2) {
        return Math.hypot(o1.x - o2.x, o1.y - o2.y);
    }
    
    initLightingGrid();
    requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
