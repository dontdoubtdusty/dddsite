<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Cozy Village - Smooth Loop</title>
    <style>
        body {
            background-color: #f0f8ff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none; 
        }

        #game-world {
            width: 500px;
            height: 400px;
            background-color: #855E42;
            border: 10px solid #5C4033;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background-image: radial-gradient(#9e7052 20%, transparent 20%),
                              radial-gradient(#9e7052 20%, transparent 20%);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
        }

        .entity {
            width: 40px;
            height: 40px;
            position: absolute;
            /* REMOVED CSS TRANSITIONS for raw 60fps control */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border-radius: 50%;
            z-index: 10;
        }

        #player {
            background-color: #ff6b6b;
            color: white;
            z-index: 20;
        }

        #neighbor {
            background-color: #4ecdc4;
            color: white;
            top: 50px;
            left: 230px;
        }

        .furniture {
            width: 40px;
            height: 40px;
            background-color: #ffe66d;
            position: absolute;
            border-radius: 5px;
            border: 2px solid #d4c04d;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            z-index: 5; 
        }

        .held {
            border-color: #ff6b6b;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 30;
        }

        #dialogue-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            background: white;
            border: 4px solid #4ecdc4;
            border-radius: 15px;
            padding: 15px;
            display: none;
            font-size: 14px;
            z-index: 100;
        }

        #instructions {
            position: absolute;
            top: -40px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #555;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <div id="game-world">
        <div id="instructions">Arrows/WASD: Move ‚Ä¢ SPACE: Action</div>
        
        <div id="plant" class="furniture" style="top: 200px; left: 100px;">ü™¥</div>
        <div id="neighbor" class="entity">üêª</div>
        <div id="player" class="entity" style="top: 300px; left: 230px;">üôÇ</div>

        <div id="dialogue-box">
            <strong style="color:#4ecdc4">Bear:</strong> <span id="dialogue-text">...</span>
        </div>
    </div>

    <script>
        const player = document.getElementById('player');
        const neighbor = document.getElementById('neighbor');
        const plant = document.getElementById('plant');
        const dialogueBox = document.getElementById('dialogue-box');
        const dialogueText = document.getElementById('dialogue-text');
        
        // Game State
        let pX = 230;
        let pY = 300;
        const speed = 4; // Lower speed per frame (since frames happen often)
        
        let fX = 100;
        let fY = 200;
        let isHoldingItem = false;

        // Input State (The "Controller")
        const keys = {
            ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false,
            w: false, s: false, a: false, d: false,
            " ": false // Spacebar
        };

        // 1. LISTEN FOR INPUT
        document.addEventListener('keydown', (e) => {
            if (keys.hasOwnProperty(e.key) || keys.hasOwnProperty(e.key.toLowerCase())) {
                keys[e.key] = true;
            }
            // Handle single-press actions (Spacebar interaction)
            if (e.key === ' ' && !e.repeat) {
                handleInteraction();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (keys.hasOwnProperty(e.key) || keys.hasOwnProperty(e.key.toLowerCase())) {
                keys[e.key] = false;
            }
        });

        // 2. THE GAME LOOP (Runs 60 times per second)
        function gameLoop() {
            let moved = false;

            // Check Input State
            if (keys.ArrowUp || keys.w) {
                if (pY > 0) pY -= speed;
                moved = true;
            }
            if (keys.ArrowDown || keys.s) {
                if (pY < 360) pY += speed;
                moved = true;
            }
            if (keys.ArrowLeft || keys.a) {
                if (pX > 0) pX -= speed;
                moved = true;
            }
            if (keys.ArrowRight || keys.d) {
                if (pX < 460) pX += speed;
                moved = true;
            }

            // Update Furniture Position if Held
            if (isHoldingItem) {
                fX = pX;
                fY = pY - 20; 
                plant.style.top = fY + 'px';
                plant.style.left = fX + 'px';
            }

            // Apply Player Position
            player.style.top = pY + 'px';
            player.style.left = pX + 'px';

            // Hide dialogue if moving
            if (moved) {
                dialogueBox.style.display = 'none';
            }

            // Request next frame
            requestAnimationFrame(gameLoop);
        }

        // Start the loop!
        requestAnimationFrame(gameLoop);


        /* --- INTERACTION LOGIC --- */
        
        function handleInteraction() {
            if (isHoldingItem) {
                dropItem();
            } else {
                const distToNeighbor = getDistance(player, neighbor);
                const distToPlant = getDistance(player, plant);

                if (distToPlant < 50) {
                    pickUpItem();
                } else if (distToNeighbor < 60) {
                    showDailyDialogue();
                }
            }
        }

        function pickUpItem() {
            isHoldingItem = true;
            plant.classList.add('held');
        }

        function dropItem() {
            isHoldingItem = false;
            plant.classList.remove('held');
            fX = Math.round(fX / 10) * 10;
            fY = Math.round(fY / 10) * 10;
            plant.style.top = fY + 'px';
            plant.style.left = fX + 'px';
        }

        function getDistance(elem1, elem2) {
            const r1 = elem1.getBoundingClientRect();
            const r2 = elem2.getBoundingClientRect();
            return Math.hypot(r1.x - r2.x, r1.y - r2.y);
        }

        function showDailyDialogue() {
            const date = new Date();
            const day = date.getDay();
            const texts = [
                "Lazy Sunday...", "Monday blues.", "Taco Tuesday!", 
                "Wednesday!", "Thursday vibe.", "Fri-yay!", "K.K. Saturday!"
            ];
            dialogueText.innerText = texts[day] || "Hello!";
            dialogueBox.style.display = 'block';
        }
    </script>
</body>
</html>
