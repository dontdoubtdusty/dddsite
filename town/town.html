<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Cozy Village - Decorator</title>
    <style>
        body {
            background-color: #f0f8ff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none; /* Prevents highlighting text while moving */
        }

        #game-world {
            width: 500px;
            height: 400px;
            background-color: #855E42;
            border: 10px solid #5C4033;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background-image: radial-gradient(#9e7052 20%, transparent 20%),
                              radial-gradient(#9e7052 20%, transparent 20%);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
        }

        .entity {
            width: 40px;
            height: 40px;
            position: absolute;
            transition: top 0.1s linear, left 0.1s linear;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border-radius: 50%;
            z-index: 10;
        }

        #player {
            background-color: #ff6b6b;
            color: white;
            z-index: 20; /* Player is always on top */
        }

        #neighbor {
            background-color: #4ecdc4;
            color: white;
            top: 50px;
            left: 230px;
        }

        /* Furniture Style */
        .furniture {
            width: 40px;
            height: 40px;
            background-color: #ffe66d;
            position: absolute;
            border-radius: 5px;
            border: 2px solid #d4c04d;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            z-index: 5; /* Below player */
            transition: top 0.1s linear, left 0.1s linear;
        }

        /* Visual cue for when item is held */
        .held {
            border-color: #ff6b6b; /* Matches player color */
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 30; /* Above everything when held */
        }

        #dialogue-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            background: white;
            border: 4px solid #4ecdc4;
            border-radius: 15px;
            padding: 15px;
            display: none;
            font-size: 14px;
            z-index: 100;
        }

        #instructions {
            position: absolute;
            top: -40px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #555;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <div id="game-world">
        <div id="instructions">Arrows: Move ‚Ä¢ SPACE: Talk / Pick Up / Drop</div>
        
        <div id="plant" class="furniture" style="top: 200px; left: 100px;">ü™¥</div>

        <div id="neighbor" class="entity">üêª</div>
        <div id="player" class="entity" style="top: 300px; left: 230px;">üôÇ</div>

        <div id="dialogue-box">
            <strong style="color:#4ecdc4">Bear:</strong> <span id="dialogue-text">...</span>
        </div>
    </div>

    <script>
        /* --- LOGIC --- */
        
        const player = document.getElementById('player');
        const neighbor = document.getElementById('neighbor');
        const plant = document.getElementById('plant');
        const dialogueBox = document.getElementById('dialogue-box');
        const dialogueText = document.getElementById('dialogue-text');
        
        // Player State
        let pX = 230;
        let pY = 300;
        const speed = 10;
        
        // Furniture State
        // We track the plant's position in variables so we can do math with them
        let fX = 100;
        let fY = 200;
        let isHoldingItem = false;

        document.addEventListener('keydown', (e) => {
            // MOVEMENT
            if (e.key === 'ArrowUp' && pY > 0) pY -= speed;
            if (e.key === 'ArrowDown' && pY < 360) pY += speed;
            if (e.key === 'ArrowLeft' && pX > 0) pX -= speed;
            if (e.key === 'ArrowRight' && pX < 460) pX += speed;
            
            // If we are holding the item, it must move WITH the player
            if (isHoldingItem) {
                // Offset the item slightly so it looks like it's in our hands (above head)
                fX = pX;
                fY = pY - 20; 
            }

            // INTERACTION
            if (e.key === ' ') {
                handleInteraction();
            } else {
                dialogueBox.style.display = 'none'; // Close chat on move
            }

            updateGraphics();
        });

        function updateGraphics() {
            player.style.top = pY + 'px';
            player.style.left = pX + 'px';
            
            plant.style.top = fY + 'px';
            plant.style.left = fX + 'px';
        }

        function handleInteraction() {
            // 1. If holding something, DROP it
            if (isHoldingItem) {
                dropItem();
                return;
            }

            // 2. If NOT holding something, check what is close
            const distToNeighbor = getDistance(player, neighbor);
            const distToPlant = getDistance(player, plant);

            // Priority: Pick up item if close, otherwise talk to neighbor
            if (distToPlant < 50) {
                pickUpItem();
            } else if (distToNeighbor < 60) {
                showDailyDialogue();
            }
        }

        function pickUpItem() {
            isHoldingItem = true;
            plant.classList.add('held'); // Adds the red border/pop effect
            
            // Immediately snap to player
            fX = pX;
            fY = pY - 20;
            updateGraphics();
        }

        function dropItem() {
            isHoldingItem = false;
            plant.classList.remove('held');
            
            // Place it slightly in front or at feet (current coords are fine)
            // But let's align it to a "grid" to make it look neat (optional polish)
            fX = Math.round(fX / 10) * 10;
            fY = Math.round(fY / 10) * 10;
            
            updateGraphics();
        }

        function getDistance(elem1, elem2) {
            const r1 = elem1.getBoundingClientRect();
            const r2 = elem2.getBoundingClientRect();
            return Math.hypot(r1.x - r2.x, r1.y - r2.y);
        }

        function showDailyDialogue() {
            const date = new Date();
            const day = date.getDay();
            const texts = [
                "Lazy Sunday...", "Monday blues.", "Taco Tuesday!", 
                "Wednesday!", "Thursday vibe.", "Fri-yay!", "K.K. Saturday!"
            ];
            dialogueText.innerText = texts[day] || "Hello!";
            dialogueBox.style.display = 'block';
        }
    </script>
</body>
</html>
